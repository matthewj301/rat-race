# Rat Rig V-core 3 Klipper Config
# Documentation: https://os.ratrig.com

# The first thing you'll need to do is go through this file and comment out / uncomment
# the files and/or settings you need.
# You'll be able to print just fine with this config as it is, but it is recommended
# that you follow these steps to properly calibrate your printer:
# 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
# 1) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
# 2) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
# 3) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html

# Read more about klipper here: https://www.klipper3d.org/Overview.html

#############################################################################################################
### CONTROL BOARD
### Pick the board you have installed and wired in your printer.
#############################################################################################################
[include custom/boards/octopus_max_ez/config.cfg]

#############################################################################################################
### BASE SETUP
#############################################################################################################
[include custom/printers/v-core-3/v-core-3.cfg]
[include RatOS/homing.cfg]
[include RatOS/macros.cfg]
[include RatOS/shell-macros.cfg]
[include RatOS/printers/v-core-3/macros.cfg]


#############################################################################################################
### STEPPER MOTORS, DRIVERS & SPEED LIMITS
### Pick the drivers and stepper motors you're using. See the RatOS documentation for custom combinations.
#############################################################################################################
[include RatOS/printers/v-core-3/steppers.cfg]

# UNCOOLED TMC 2209 + LDO-42STH48-2504AC
#[include RatOS/printers/v-core-3/tmc2209.cfg]
#[include RatOS/printers/v-core-3/speed-limits-basic.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-x.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-y.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z1.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z2.cfg]

# COOLED TMC 2209 + LDO-42STH48-2504AC
# This increases motor torque, positional accuracy and speed limits.
# don't enable this before your printer is fully configured and you have a fan blowing on your stepper drivers.
#[include RatOS/printers/v-core-3/speed-limits-performance.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-x.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-y.cfg]

[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z1.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z2.cfg]

# STEALTH MODE (Enables stealthchop and limits velocity and acceleration)
# NOTE: You still need to include one of the above stepper motor definitions.
# NOTE: This will make your printer quiter but less accurate, it's an inherent side effect of stealthchop.
#[include RatOS/printers/v-core-3/speed-limits-stealth.cfg]
#[include RatOS/printers/v-core-3/tmc2209-stealth.cfg]

#############################################################################################################
### PHYSICAL DIMENSIONS
### Pick your printer size
#############################################################################################################
# Remove the # from your printer size below.
# Similarly add a # in front of [include RatOS/printers/v-core-3/300.cfg] if you have a bigger machine.
#[include RatOS/printers/v-core-3/200.cfg]
[include RatOS/printers/v-core-3/300.cfg]
#[include RatOS/printers/v-core-3/400.cfg]
#[include RatOS/printers/v-core-3/500.cfg]

#############################################################################################################
### HOMING
### Pick your probe and endstops
#############################################################################################################
# BL Touch
#[include RatOS/z-probe/bltouch.cfg]

# Inductive/Capacitive probe
#[include RatOS/z-probe/probe.cfg]

# Beacon probe
#[include RatOS/z-probe/beacon.cfg]

# Euclid probe (please read the RatOS documentation for instructions)
# [include RatOS/z-probe/euclid.cfg]

# Klicky probe (please read the RatOS documentation for instructions)
#[include RatOS/z-probe/klicky/klicky.cfg]
#[include RatOS/z-probe/klicky/unklicky.cfg]

# Physical endstop on X
# [include RatOS/printers/v-core-3/physical-endstop-x.cfg]
# Physical endstop on Y
# [include RatOS/printers/v-core-3/physical-endstop-y.cfg]

# Sensorless homing (Beware: this requires manual tinkering and does not work if your x/y stepper drivers
# have clipped DIAG pins). It is strongly encouraged to use physical endstops if you're a beginner.
# If you still wish to proceed, copy config/templates/sensorless-homing-tmc2209.cfg to the root directory and
# remove the # from the line below, then tune the settings in it, until you have reliable homing.
#[include sensorless-homing-tmc2209.cfg]

# If you want to only run sensorless homing on a single axis, copy the corresponding file from config/templates
# to the root directory and uncomment it below. Then tweak the settings in it until you have reliable homing.
#[include sensorless-x-homing-tmc2209.cfg]
#[include sensorless-y-homing-tmc2209.cfg]

#############################################################################################################
### INPUT SHAPER
### Enable/disable input shaper calibration
#############################################################################################################
# Uncomment this next line if you have an ADXL345 connected to your control board
#[include RatOS/printers/v-core-3/input-shaper.cfg]


#############################################################################################################
### TOOLHEAD
### Pick your extruder and hotend
#############################################################################################################
#[include RatOS/extruders/bmg.cfg]
#[include RatOS/extruders/lgx.cfg]
#[include RatOS/extruders/lgx-lite.cfg]
#[include RatOS/extruders/orbiter.cfg]
#[include RatOS/extruders/orbiter-2.cfg]
#[include RatOS/extruders/hemera.cfg]
#[include RatOS/extruders/titan.cfg]

# Hotend
#[include RatOS/hotends/v6.cfg]
#[include RatOS/hotends/revo.cfg]
#[include RatOS/hotends/dragonfly.cfg]
#[include RatOS/hotends/rapido.cfg]
#[include RatOS/hotends/copperhead.cfg]
#[include RatOS/hotends/mosquito.cfg]
#[include RatOS/hotends/mosquito-magnum.cfg]
#[include RatOS/hotends/dragon-standard-flow.cfg]
#[include RatOS/hotends/dragon-high-flow.cfg]


#############################################################################################################
### FANS
### If your board has 4 pin fan headers and you want to use them, you can enable them here.
### NOTE: If none are uncommented, the default 2pin fan headers will be used.
#############################################################################################################
# Part cooling
#[include RatOS/4pin-fans/part-cooling-fan-25khz.cfg]
#[include RatOS/4pin-fans/part-cooling-fan-100hz.cfg]

# Hotend / Toolhead cooling
#[include RatOS/4pin-fans/toolhead-fan-25khz.cfg]
#[include RatOS/4pin-fans/toolhead-fan-100hz.cfg]

# Control board cooling
#[include RatOS/4pin-fans/controller-fan-25khz.cfg]
#[include RatOS/4pin-fans/controller-fan-100hz.cfg]


#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: True
variable_preheat_extruder: True
variable_nozzle_priming: "none"
variable_start_print_park_in: "front"
variable_start_print_park_z_height: 50
variable_safe_home_x: 275
variable_safe_home_y: 260
variable_skew_profile: "true"
variable_end_print_park_in: "front"
variable_pause_print_park_in: "front"
variable_macro_travel_speed: 350
variable_nozzle_prime_start_x: 295
variable_adaptive_mesh: False
variable_calibrate_bed_mesh: True
variable_bed_mesh_profile: "default"

#############################################################################################################
### PRINTER CONFIGURATION
### Customize the defaults to your specific build
#############################################################################################################
[include mmu/base/*.cfg]

[stepper_x]
position_min: -11
position_max: 306
position_endstop: -11
homing_speed: 100

[stepper_y]
dir_pin: y_dir_pin # Add ! in front of pin name to reverse Y stepper direction
position_min: 0
position_max: 306
position_endstop: 306
rotation_distance: 40 # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 100

[stepper_z]
dir_pin: z0_dir_pin # Add ! in front of pin name to reverse Z stepper direction
rotation_distance: 4 # 4 for TR8*4 lead screws
position_max: 310

[stepper_z1]
dir_pin: z1_dir_pin # Add ! in front of pin name to reverse Z1 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[stepper_z2]
dir_pin: z2_dir_pin # Add ! in front of pin name to reverse Z2 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[printer]
max_z_velocity: 80

#[resonance_tester]
#probe_points:
#    150,150,20

#############################################################################################################
### TOOLBOARD
### If you have a toolboard installed, select it here
#############################################################################################################
#[include RatOS/boards/btt-ebb42-12/toolboard-config.cfg]

#[include RatOS/toolboard/input-shaper.cfg]

#############################################################################################################
### USER OVERRIDES
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
#############################################################################################################
[include timelapse.cfg]

[include custom/ratos_macros.cfg]

[include custom/fans/*]

[include custom/sensors/chamber_thermistors.cfg]

[include custom/awd/awd.cfg]

[include custom/probes/beacon.cfg]

[include custom/extruders/Vz-HextrudORT-Plus/config.cfg]
[include custom/hotends/goliath.cfg]

[include custom/autotune.cfg]

[z_tilt]
z_positions:
	-5, -2
	151,300
	306, -2
    
# Enable object exclusion
[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 16.481
#*# pid_ki = 0.923
#*# pid_kd = 73.546
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 70.772
#*# pid_ki = 2.496
#*# pid_kd = 501.596
#*#
#*# [probe]
#*# z_offset = 10.590
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 96.0
#*# shaper_type_y = mzv
#*# shaper_freq_y = 77.4
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	0.040729, 0.093125, 0.065208
#*# 	-0.021771, 0.025521, 0.003021
#*# 	0.012917, 0.002812, 0.019167
#*# 	-0.035729, 0.009792, -0.015521
#*# 	-0.045313, 0.020000, 0.031562
#*# min_x = 84.65
#*# max_x = 215.33
#*# min_y = 67.0
#*# max_y = 235.36
#*# x_count = 3
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*#
#*# [skew_correction pla_skew]
#*# xy_skew = 0.00544136003736162
#*# xz_skew = 0.0013690233785870565
#*# yz_skew = -0.004754598840646335
#*#
#*# [skew_correction asa_skew]
#*# xy_skew = 0.0007743165494060175
#*# xz_skew = -0.004692878667026418
#*# yz_skew = -0.0033394791934769903
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.012633, -0.031866, -0.051621, -0.064167, -0.066877, -0.070422, -0.068849, -0.073873, -0.084969, -0.095715, -0.100853, -0.101364, -0.106668, -0.102365, -0.102189, -0.108190, -0.110460, -0.110339, -0.100220, -0.090814, -0.073965, -0.048735, -0.040879, -0.039044, -0.039377
#*# 	  -0.022537, -0.039247, -0.047330, -0.054247, -0.061901, -0.072758, -0.075804, -0.081242, -0.096357, -0.090411, -0.089099, -0.095438, -0.109937, -0.113398, -0.113421, -0.117802, -0.103825, -0.096788, -0.095417, -0.094156, -0.075169, -0.056791, -0.051926, -0.038652, -0.034855
#*# 	  -0.011169, -0.030191, -0.051290, -0.062022, -0.067792, -0.071215, -0.067689, -0.080392, -0.085262, -0.096385, -0.096464, -0.102670, -0.107889, -0.102388, -0.099787, -0.104312, -0.110083, -0.103231, -0.103376, -0.092899, -0.065565, -0.051908, -0.040112, -0.039610, -0.041022
#*# 	  -0.016495, -0.044348, -0.061700, -0.064740, -0.062746, -0.074901, -0.076802, -0.082950, -0.097491, -0.090419, -0.096592, -0.090905, -0.108716, -0.111452, -0.109452, -0.114432, -0.112314, -0.104267, -0.094667, -0.093465, -0.074531, -0.053791, -0.048564, -0.047235, -0.038826
#*# 	  -0.014317, -0.038023, -0.057016, -0.067292, -0.072673, -0.068026, -0.070464, -0.075773, -0.086993, -0.093834, -0.092769, -0.099910, -0.099397, -0.101333, -0.108990, -0.113777, -0.109600, -0.102733, -0.101986, -0.090519, -0.070758, -0.053617, -0.044168, -0.039088, -0.038103
#*# 	  0.008176, -0.027413, -0.045162, -0.049535, -0.046474, -0.047348, -0.052496, -0.052551, -0.058647, -0.073835, -0.071977, -0.071789, -0.080933, -0.092322, -0.089772, -0.085133, -0.091719, -0.082303, -0.071707, -0.066878, -0.057931, -0.039890, -0.024900, -0.027375, -0.018158
#*# 	  0.022942, -0.007718, -0.026459, -0.038568, -0.045478, -0.041178, -0.041803, -0.048502, -0.059495, -0.058018, -0.070206, -0.080743, -0.081490, -0.079316, -0.085882, -0.091292, -0.076095, -0.072453, -0.072335, -0.062700, -0.052416, -0.040898, -0.028692, -0.015451, -0.019139
#*# 	  0.017599, -0.014089, -0.042350, -0.044964, -0.048802, -0.042895, -0.052624, -0.057708, -0.062436, -0.076210, -0.085713, -0.088206, -0.086056, -0.094161, -0.089203, -0.086262, -0.092040, -0.093034, -0.080594, -0.066255, -0.066946, -0.050954, -0.036320, -0.035242, -0.034925
#*# 	  0.026173, -0.004767, -0.020783, -0.031935, -0.030264, -0.035827, -0.046576, -0.058548, -0.060562, -0.058438, -0.069682, -0.077707, -0.077927, -0.084049, -0.087516, -0.084660, -0.074264, -0.076830, -0.072925, -0.060281, -0.054404, -0.046133, -0.032088, -0.018791, -0.017230
#*# 	  0.034229, 0.009280, -0.015844, -0.023958, -0.022135, -0.018123, -0.025491, -0.042673, -0.046436, -0.060069, -0.070589, -0.069925, -0.064587, -0.061365, -0.070031, -0.065087, -0.060195, -0.071389, -0.064498, -0.052517, -0.040977, -0.030574, -0.014794, -0.016641, -0.011121
#*# 	  0.026327, 0.007041, -0.006692, -0.018343, -0.016955, -0.024656, -0.039361, -0.055284, -0.053071, -0.056517, -0.065155, -0.067389, -0.074595, -0.082424, -0.087439, -0.069615, -0.066172, -0.069626, -0.065207, -0.059314, -0.054054, -0.041711, -0.021535, -0.014601, -0.013904
#*# 	  0.020403, 0.000194, -0.008907, -0.025021, -0.025861, -0.033852, -0.033830, -0.049598, -0.056659, -0.061362, -0.078953, -0.074614, -0.081710, -0.076252, -0.081749, -0.074167, -0.071480, -0.084174, -0.084731, -0.070713, -0.052170, -0.040028, -0.023472, -0.015651, -0.019514
#*# 	  0.019436, -0.000804, -0.010078, -0.017915, -0.024569, -0.038937, -0.050926, -0.055178, -0.054636, -0.059691, -0.061036, -0.069958, -0.083417, -0.095248, -0.091750, -0.078400, -0.076142, -0.079929, -0.072354, -0.074612, -0.064494, -0.045153, -0.026152, -0.015113, -0.012701
#*# 	  0.025039, 0.006835, -0.001357, -0.017260, -0.027713, -0.030947, -0.030021, -0.036371, -0.044037, -0.050988, -0.068996, -0.074100, -0.076035, -0.068617, -0.066655, -0.069739, -0.066642, -0.075092, -0.073699, -0.064341, -0.048830, -0.031487, -0.013828, -0.003973, 0.000071
#*# 	  0.025230, 0.008324, 0.000936, -0.010388, -0.022295, -0.029145, -0.041726, -0.047198, -0.049420, -0.050659, -0.054799, -0.061522, -0.074571, -0.083113, -0.077441, -0.070004, -0.066330, -0.066531, -0.066782, -0.065081, -0.057071, -0.035960, -0.018283, -0.003326, 0.005351
#*# 	  0.019898, 0.003681, -0.005501, -0.014978, -0.028103, -0.028025, -0.040167, -0.040241, -0.053002, -0.055806, -0.060457, -0.074685, -0.082780, -0.082816, -0.078581, -0.073669, -0.068828, -0.069638, -0.076584, -0.075280, -0.056812, -0.034085, -0.021954, -0.008655, -0.005734
#*# 	  0.030318, 0.019185, 0.011957, 0.003914, -0.004275, -0.019270, -0.026823, -0.028934, -0.037187, -0.036232, -0.042459, -0.054676, -0.070413, -0.072500, -0.063397, -0.053497, -0.051865, -0.046201, -0.051073, -0.049269, -0.040189, -0.021734, -0.001498, 0.006933, 0.010580
#*# 	  0.043757, 0.033492, 0.020953, 0.013272, 0.000948, -0.006448, -0.009617, -0.013871, -0.019057, -0.032773, -0.041016, -0.051010, -0.061193, -0.057680, -0.051943, -0.043653, -0.044878, -0.042599, -0.045804, -0.043584, -0.028653, -0.009770, 0.006528, 0.014541, 0.013009
#*# 	  0.033998, 0.020790, 0.013052, 0.007681, 0.001514, -0.013183, -0.023991, -0.033007, -0.037402, -0.045392, -0.053882, -0.060640, -0.068094, -0.067298, -0.061659, -0.060463, -0.052628, -0.052851, -0.049945, -0.050922, -0.042625, -0.028344, -0.010997, 0.000802, 0.003739
#*# 	  0.041747, 0.025763, 0.021347, 0.011431, 0.003078, -0.014192, -0.016683, -0.026330, -0.026733, -0.039919, -0.044232, -0.053546, -0.060986, -0.063337, -0.057305, -0.050064, -0.047570, -0.049319, -0.047944, -0.052329, -0.041525, -0.030961, -0.005137, 0.002989, 0.006913
#*# 	  0.052295, 0.036014, 0.029382, 0.018840, 0.004328, -0.002811, -0.006274, -0.020074, -0.023126, -0.029745, -0.037750, -0.041274, -0.050616, -0.051209, -0.049203, -0.048476, -0.043967, -0.045956, -0.047280, -0.043336, -0.044921, -0.031599, -0.012110, 0.004845, 0.009896
#*# 	  0.053828, 0.039993, 0.032189, 0.016725, 0.007015, -0.003531, -0.011431, -0.015353, -0.018848, -0.024151, -0.031701, -0.037435, -0.050953, -0.052457, -0.050067, -0.044838, -0.047997, -0.046651, -0.050710, -0.056074, -0.054646, -0.037857, -0.017665, 0.004175, 0.006531
#*# 	  0.061698, 0.048767, 0.038058, 0.023958, 0.016088, 0.006301, 0.001553, -0.010348, -0.013633, -0.017126, -0.026108, -0.030521, -0.038064, -0.041747, -0.039280, -0.038762, -0.042170, -0.045782, -0.046815, -0.051014, -0.046909, -0.033615, -0.011544, 0.008389, 0.015073
#*# 	  0.075054, 0.062269, 0.054508, 0.037467, 0.027133, 0.019221, 0.014787, 0.010488, 0.003124, -0.000567, -0.012811, -0.021546, -0.027185, -0.031242, -0.030237, -0.033457, -0.034542, -0.038830, -0.041796, -0.041169, -0.036344, -0.017883, 0.000652, 0.016983, 0.021248
#*# 	  0.079945, 0.068633, 0.057874, 0.045399, 0.035932, 0.030965, 0.024002, 0.012555, 0.001663, -0.003806, -0.011173, -0.023308, -0.031095, -0.029096, -0.028668, -0.031100, -0.031890, -0.032764, -0.032875, -0.032509, -0.026577, -0.014582, 0.000801, 0.017595, 0.008456
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 275.0
#*# min_y = 35.0
#*# max_y = 260.0
#*#
#*# [beacon model default]
#*# model_coef = 1.486171599889158,
#*# 	  1.8296930858966607,
#*# 	  0.7753854328053685,
#*# 	  0.4082127771026672,
#*# 	  0.42498675291901156,
#*# 	  0.2547538934585003,
#*# 	  -0.3172852337313206,
#*# 	  -0.29736049238224543,
#*# 	  0.23083502635453504,
#*# 	  0.20681143578879166
#*# model_domain = 1.8304692628179943e-07,1.9266397583584346e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 55.865263
#*# model_offset = 0.02500
#*#
#*# [beacon model hot]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [beacon model fulaflex-3_hot]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [beacon model fulaflex-3_hot_detailed]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
