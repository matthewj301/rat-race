# Rat Rig V-core 3 Klipper Config
# Documentation: https://os.ratrig.com

# The first thing you'll need to do is go through this file and comment out / uncomment
# the files and/or settings you need.
# You'll be able to print just fine with this config as it is, but it is recommended
# that you follow these steps to properly calibrate your printer:
# 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
# 1) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
# 2) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
# 3) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html

# Read more about klipper here: https://www.klipper3d.org/Overview.html

#############################################################################################################
### CONTROL BOARD
### Pick the board you have installed and wired in your printer.
#############################################################################################################
[include custom/boards/octopus_max_ez/config.cfg]

#############################################################################################################
### BASE SETUP
#############################################################################################################
[include custom/printers/v-core-3/v-core-3.cfg]
[include RatOS/homing.cfg]
[include RatOS/macros.cfg]
[include RatOS/shell-macros.cfg]
[include RatOS/printers/v-core-3/macros.cfg]


#############################################################################################################
### STEPPER MOTORS, DRIVERS & SPEED LIMITS
### Pick the drivers and stepper motors you're using. See the RatOS documentation for custom combinations.
#############################################################################################################
[include RatOS/printers/v-core-3/steppers.cfg]

# UNCOOLED TMC 2209 + LDO-42STH48-2504AC
#[include RatOS/printers/v-core-3/tmc2209.cfg]
#[include RatOS/printers/v-core-3/speed-limits-basic.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-x.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-y.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z1.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z2.cfg]

# COOLED TMC 2209 + LDO-42STH48-2504AC
# This increases motor torque, positional accuracy and speed limits.
# don't enable this before your printer is fully configured and you have a fan blowing on your stepper drivers.
#[include RatOS/printers/v-core-3/speed-limits-performance.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-x.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-y.cfg]

[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z1.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z2.cfg]

# STEALTH MODE (Enables stealthchop and limits velocity and acceleration)
# NOTE: You still need to include one of the above stepper motor definitions.
# NOTE: This will make your printer quiter but less accurate, it's an inherent side effect of stealthchop.
#[include RatOS/printers/v-core-3/speed-limits-stealth.cfg]
#[include RatOS/printers/v-core-3/tmc2209-stealth.cfg]

#############################################################################################################
### PHYSICAL DIMENSIONS
### Pick your printer size
#############################################################################################################
# Remove the # from your printer size below.
# Similarly add a # in front of [include RatOS/printers/v-core-3/300.cfg] if you have a bigger machine.
#[include RatOS/printers/v-core-3/200.cfg]
[include RatOS/printers/v-core-3/300.cfg]
#[include RatOS/printers/v-core-3/400.cfg]
#[include RatOS/printers/v-core-3/500.cfg]

#############################################################################################################
### HOMING
### Pick your probe and endstops
#############################################################################################################
# BL Touch
#[include RatOS/z-probe/bltouch.cfg]

# Inductive/Capacitive probe
#[include RatOS/z-probe/probe.cfg]

# Beacon probe
#[include RatOS/z-probe/beacon.cfg]

# Euclid probe (please read the RatOS documentation for instructions)
# [include RatOS/z-probe/euclid.cfg]

# Klicky probe (please read the RatOS documentation for instructions)
#[include RatOS/z-probe/klicky/klicky.cfg]
#[include RatOS/z-probe/klicky/unklicky.cfg]

# Physical endstop on X
# [include RatOS/printers/v-core-3/physical-endstop-x.cfg]
# Physical endstop on Y
# [include RatOS/printers/v-core-3/physical-endstop-y.cfg]

# Sensorless homing (Beware: this requires manual tinkering and does not work if your x/y stepper drivers
# have clipped DIAG pins). It is strongly encouraged to use physical endstops if you're a beginner.
# If you still wish to proceed, copy config/templates/sensorless-homing-tmc2209.cfg to the root directory and
# remove the # from the line below, then tune the settings in it, until you have reliable homing.
#[include sensorless-homing-tmc2209.cfg]

# If you want to only run sensorless homing on a single axis, copy the corresponding file from config/templates
# to the root directory and uncomment it below. Then tweak the settings in it until you have reliable homing.
#[include sensorless-x-homing-tmc2209.cfg]
#[include sensorless-y-homing-tmc2209.cfg]

#############################################################################################################
### INPUT SHAPER
### Enable/disable input shaper calibration
#############################################################################################################
# Uncomment this next line if you have an ADXL345 connected to your control board
#[include RatOS/printers/v-core-3/input-shaper.cfg]


#############################################################################################################
### TOOLHEAD
### Pick your extruder and hotend
#############################################################################################################
#[include RatOS/extruders/bmg.cfg]
#[include RatOS/extruders/lgx.cfg]
#[include RatOS/extruders/lgx-lite.cfg]
#[include RatOS/extruders/orbiter.cfg]
#[include RatOS/extruders/orbiter-2.cfg]
#[include RatOS/extruders/hemera.cfg]
#[include RatOS/extruders/titan.cfg]

# Hotend
#[include RatOS/hotends/v6.cfg]
#[include RatOS/hotends/revo.cfg]
#[include RatOS/hotends/dragonfly.cfg]
#[include RatOS/hotends/rapido.cfg]
#[include RatOS/hotends/copperhead.cfg]
#[include RatOS/hotends/mosquito.cfg]
#[include RatOS/hotends/mosquito-magnum.cfg]
#[include RatOS/hotends/dragon-standard-flow.cfg]
#[include RatOS/hotends/dragon-high-flow.cfg]


#############################################################################################################
### FANS
### If your board has 4 pin fan headers and you want to use them, you can enable them here.
### NOTE: If none are uncommented, the default 2pin fan headers will be used.
#############################################################################################################
# Part cooling
#[include RatOS/4pin-fans/part-cooling-fan-25khz.cfg]
#[include RatOS/4pin-fans/part-cooling-fan-100hz.cfg]

# Hotend / Toolhead cooling
#[include RatOS/4pin-fans/toolhead-fan-25khz.cfg]
#[include RatOS/4pin-fans/toolhead-fan-100hz.cfg]

# Control board cooling
#[include RatOS/4pin-fans/controller-fan-25khz.cfg]
#[include RatOS/4pin-fans/controller-fan-100hz.cfg]


#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: True
variable_preheat_extruder: True
variable_nozzle_priming: "none"
variable_start_print_park_in: "front"
variable_start_print_park_z_height: 50
variable_safe_home_x: 275
variable_safe_home_y: 260
variable_skew_profile: "true"
variable_end_print_park_in: "front"
variable_pause_print_park_in: "front"
variable_macro_travel_speed: 350
variable_nozzle_prime_start_x: 295
variable_adaptive_mesh: False
variable_calibrate_bed_mesh: True
variable_bed_mesh_profile: "default"

#############################################################################################################
### PRINTER CONFIGURATION
### Customize the defaults to your specific build
#############################################################################################################
[include mmu/base/*.cfg]

[stepper_x]
position_min: -11
position_max: 306
position_endstop: -11
homing_speed: 100

[stepper_y]
dir_pin: y_dir_pin # Add ! in front of pin name to reverse Y stepper direction
position_min: 0
position_max: 306
position_endstop: 306
rotation_distance: 40 # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 100

[stepper_z]
dir_pin: z0_dir_pin # Add ! in front of pin name to reverse Z stepper direction
rotation_distance: 4 # 4 for TR8*4 lead screws
position_max: 310

[stepper_z1]
dir_pin: z1_dir_pin # Add ! in front of pin name to reverse Z1 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[stepper_z2]
dir_pin: z2_dir_pin # Add ! in front of pin name to reverse Z2 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[printer]
max_z_velocity: 80

#[resonance_tester]
#probe_points:
#    150,150,20

#############################################################################################################
### TOOLBOARD
### If you have a toolboard installed, select it here
#############################################################################################################
#[include RatOS/boards/btt-ebb42-12/toolboard-config.cfg]

#[include RatOS/toolboard/input-shaper.cfg]

#############################################################################################################
### USER OVERRIDES
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
#############################################################################################################
[include timelapse.cfg]

[include custom/ratos_macros.cfg]

[include custom/fans/*]

[include custom/sensors/chamber_thermistors.cfg]

[include custom/awd/awd.cfg]

[include custom/probes/beacon.cfg]

[include custom/extruders/Vz-HextrudORT-Plus/config.cfg]
[include custom/hotends/goliath.cfg]

[include custom/autotune.cfg]

[z_tilt]
z_positions:
	-5, -2
	151,300
	306, -2
    
# Enable object exclusion
[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 16.481
#*# pid_ki = 0.923
#*# pid_kd = 73.546
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 70.772
#*# pid_ki = 2.496
#*# pid_kd = 501.596
#*#
#*# [probe]
#*# z_offset = 10.590
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 96.0
#*# shaper_type_y = mzv
#*# shaper_freq_y = 77.4
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	0.040729, 0.093125, 0.065208
#*# 	-0.021771, 0.025521, 0.003021
#*# 	0.012917, 0.002812, 0.019167
#*# 	-0.035729, 0.009792, -0.015521
#*# 	-0.045313, 0.020000, 0.031562
#*# min_x = 84.65
#*# max_x = 215.33
#*# min_y = 67.0
#*# max_y = 235.36
#*# x_count = 3
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*#
#*# [skew_correction pla_skew]
#*# xy_skew = 0.00544136003736162
#*# xz_skew = 0.0013690233785870565
#*# yz_skew = -0.004754598840646335
#*#
#*# [skew_correction asa_skew]
#*# xy_skew = 0.0007743165494060175
#*# xz_skew = -0.004692878667026418
#*# yz_skew = -0.0033394791934769903
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.042111, -0.065915, -0.081282, -0.098827, -0.106207, -0.122809, -0.137433, -0.146690, -0.154746, -0.142974, -0.151328, -0.155963, -0.172853, -0.185655, -0.189823, -0.183451, -0.153843, -0.154889, -0.158237, -0.144596, -0.134367, -0.110095, -0.090564, -0.066305, -0.060666
#*# 	  -0.027647, -0.051573, -0.091588, -0.110738, -0.120842, -0.121265, -0.127300, -0.126510, -0.133706, -0.162903, -0.173227, -0.179478, -0.172469, -0.176647, -0.165041, -0.161957, -0.154458, -0.175530, -0.170181, -0.144970, -0.122208, -0.092967, -0.075096, -0.072673, -0.077901
#*# 	  -0.031892, -0.058352, -0.078071, -0.093268, -0.109631, -0.126436, -0.132335, -0.142535, -0.129947, -0.137991, -0.145821, -0.162450, -0.168213, -0.181716, -0.180857, -0.152538, -0.149256, -0.148908, -0.155645, -0.150090, -0.125461, -0.102808, -0.067672, -0.062581, -0.058907
#*# 	  -0.025527, -0.051119, -0.072276, -0.110893, -0.120454, -0.128286, -0.124264, -0.120896, -0.129000, -0.133558, -0.164689, -0.172105, -0.177348, -0.168167, -0.155950, -0.151620, -0.147689, -0.167623, -0.162850, -0.147668, -0.116831, -0.084719, -0.066176, -0.056325, -0.074802
#*# 	  -0.033671, -0.062468, -0.082604, -0.101936, -0.111218, -0.125441, -0.130757, -0.134199, -0.125022, -0.129653, -0.137890, -0.154162, -0.171476, -0.175613, -0.173073, -0.147769, -0.144914, -0.151897, -0.149464, -0.143089, -0.123185, -0.098830, -0.066610, -0.059127, -0.059517
#*# 	  -0.010372, -0.032420, -0.054492, -0.082624, -0.101054, -0.106158, -0.095973, -0.098926, -0.097612, -0.104094, -0.135556, -0.146267, -0.154483, -0.144595, -0.141459, -0.124333, -0.120970, -0.117896, -0.137201, -0.127467, -0.097111, -0.075633, -0.048172, -0.035293, -0.031369
#*# 	  0.007859, -0.027108, -0.049557, -0.069820, -0.085768, -0.094142, -0.091749, -0.085227, -0.091179, -0.098929, -0.118417, -0.130659, -0.147004, -0.146444, -0.124275, -0.118877, -0.111176, -0.116070, -0.114341, -0.114162, -0.101601, -0.066651, -0.047681, -0.035936, -0.036885
#*# 	  0.004642, -0.025150, -0.046344, -0.062002, -0.091718, -0.094280, -0.099228, -0.099103, -0.094898, -0.103498, -0.112646, -0.146359, -0.154513, -0.152358, -0.135857, -0.121962, -0.117635, -0.113617, -0.130950, -0.124928, -0.109504, -0.083576, -0.056694, -0.041452, -0.036203
#*# 	  0.012694, -0.020476, -0.044737, -0.058839, -0.072261, -0.082123, -0.090765, -0.083734, -0.088409, -0.102841, -0.114145, -0.131311, -0.139665, -0.138390, -0.116962, -0.110524, -0.108658, -0.116891, -0.118759, -0.108812, -0.095667, -0.065664, -0.048307, -0.035318, -0.032938
#*# 	  0.024398, -0.008162, -0.018522, -0.033138, -0.053270, -0.069173, -0.080917, -0.080183, -0.088271, -0.085321, -0.095873, -0.122909, -0.125779, -0.123800, -0.113053, -0.106375, -0.092556, -0.088125, -0.090809, -0.102678, -0.085900, -0.058524, -0.038740, -0.017177, -0.009759
#*# 	  0.016891, -0.006952, -0.027984, -0.046447, -0.054372, -0.065375, -0.068077, -0.080741, -0.083635, -0.097684, -0.107005, -0.122759, -0.129745, -0.115300, -0.111448, -0.100966, -0.103431, -0.111360, -0.111239, -0.103116, -0.076672, -0.056783, -0.039036, -0.029603, -0.024861
#*# 	  0.004380, -0.013975, -0.020903, -0.032480, -0.045568, -0.072989, -0.086058, -0.095305, -0.093792, -0.092606, -0.099980, -0.105630, -0.130565, -0.133294, -0.129246, -0.112035, -0.101609, -0.100878, -0.099495, -0.108172, -0.091894, -0.069202, -0.044120, -0.022481, -0.015228
#*# 	  0.009592, -0.014846, -0.029395, -0.045792, -0.057643, -0.072509, -0.072577, -0.078134, -0.090838, -0.097357, -0.112146, -0.119871, -0.128273, -0.122410, -0.117065, -0.116781, -0.113056, -0.119529, -0.114929, -0.111119, -0.084182, -0.063038, -0.046004, -0.030813, -0.025353
#*# 	  0.007304, -0.005630, -0.018716, -0.025450, -0.038487, -0.066325, -0.076744, -0.083632, -0.078859, -0.085839, -0.089586, -0.096521, -0.105605, -0.122466, -0.117348, -0.107055, -0.103355, -0.093153, -0.091622, -0.087982, -0.087623, -0.065930, -0.034945, -0.019549, -0.002909
#*# 	  0.021137, -0.001457, -0.017236, -0.033617, -0.046172, -0.052406, -0.062091, -0.071193, -0.081209, -0.082713, -0.097561, -0.104109, -0.102978, -0.105933, -0.105363, -0.104371, -0.101636, -0.104422, -0.101652, -0.086533, -0.073437, -0.052815, -0.034489, -0.014268, -0.003523
#*# 	  0.006330, -0.011447, -0.021127, -0.028416, -0.037537, -0.045913, -0.074973, -0.082115, -0.089928, -0.086807, -0.087548, -0.095081, -0.102173, -0.121633, -0.121620, -0.111526, -0.099689, -0.089642, -0.089799, -0.085469, -0.084180, -0.061724, -0.040501, -0.020250, -0.003209
#*# 	  0.026366, 0.008356, -0.008180, -0.019767, -0.027939, -0.037993, -0.048021, -0.058690, -0.067294, -0.074904, -0.082134, -0.088662, -0.093922, -0.095032, -0.095858, -0.085922, -0.085230, -0.080582, -0.079936, -0.068832, -0.056812, -0.038315, -0.014466, -0.002078, 0.006541
#*# 	  0.031735, 0.017683, 0.005882, -0.004921, -0.010252, -0.017592, -0.035442, -0.053029, -0.060003, -0.061075, -0.070989, -0.071247, -0.080052, -0.080330, -0.087297, -0.081692, -0.073210, -0.067310, -0.058347, -0.055999, -0.044029, -0.032680, -0.010236, 0.007450, 0.013267
#*# 	  0.031814, 0.010292, -0.004239, -0.011327, -0.018576, -0.033166, -0.048432, -0.057916, -0.066984, -0.078833, -0.087576, -0.087009, -0.091517, -0.092286, -0.091937, -0.090803, -0.084837, -0.082878, -0.071531, -0.070834, -0.059485, -0.043681, -0.022204, -0.003770, 0.003079
#*# 	  0.031704, 0.011037, 0.001430, -0.007764, -0.015355, -0.029779, -0.040640, -0.058476, -0.065922, -0.077260, -0.077976, -0.081346, -0.084673, -0.086603, -0.090759, -0.084053, -0.077975, -0.076779, -0.068705, -0.062886, -0.058130, -0.046016, -0.019732, -0.006896, 0.007462
#*# 	  0.044909, 0.022321, 0.012211, -0.001357, -0.017722, -0.026677, -0.033922, -0.049474, -0.059394, -0.066253, -0.075245, -0.072771, -0.078238, -0.082028, -0.079152, -0.077496, -0.074282, -0.072502, -0.070652, -0.066630, -0.064441, -0.046728, -0.024384, -0.001517, 0.009832
#*# 	  0.049547, 0.027558, 0.013245, -0.001442, -0.014854, -0.021290, -0.031651, -0.045380, -0.056825, -0.063000, -0.065140, -0.069349, -0.077269, -0.076895, -0.078002, -0.077509, -0.080420, -0.072309, -0.074714, -0.071916, -0.066616, -0.051909, -0.027144, -0.004333, 0.008405
#*# 	  0.053610, 0.037837, 0.022643, 0.003738, -0.006301, -0.017424, -0.025965, -0.037989, -0.045856, -0.050669, -0.058705, -0.064021, -0.067525, -0.071233, -0.070309, -0.066319, -0.069198, -0.072019, -0.071757, -0.071279, -0.063749, -0.046680, -0.021523, 0.002635, 0.016510
#*# 	  0.068214, 0.049017, 0.034854, 0.016645, 0.003459, -0.005037, -0.009276, -0.017036, -0.026798, -0.034888, -0.044501, -0.050857, -0.058016, -0.058323, -0.059283, -0.063686, -0.063975, -0.064807, -0.064273, -0.059938, -0.052710, -0.031194, -0.007633, 0.013018, 0.023352
#*# 	  0.074680, 0.055838, 0.042673, 0.022651, 0.009570, 0.005869, -0.002688, -0.015714, -0.027567, -0.032744, -0.044366, -0.055572, -0.062079, -0.060457, -0.061420, -0.061926, -0.060613, -0.060000, -0.058664, -0.054441, -0.045393, -0.029245, -0.008538, 0.010585, 0.008012
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 275.0
#*# min_y = 35.0
#*# max_y = 260.0
#*#
#*# [beacon model default]
#*# model_coef = 1.486171599889158,
#*# 	1.8296930858966607,
#*# 	0.7753854328053685,
#*# 	0.4082127771026672,
#*# 	0.42498675291901156,
#*# 	0.2547538934585003,
#*# 	-0.3172852337313206,
#*# 	-0.29736049238224543,
#*# 	0.23083502635453504,
#*# 	0.20681143578879166
#*# model_domain = 1.8304692628179943e-07,1.9266397583584346e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 55.865263
#*# model_offset = 0.02500
#*#
#*# [beacon model hot]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [beacon model fulaflex-3_hot]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [beacon model fulaflex-3_hot_detailed]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [skew_correction abs_skew_profile]
#*# xy_skew = 0.0003323493754201648
#*# xz_skew = -0.00013435399970224038
#*# yz_skew = 0.000601050295107025
