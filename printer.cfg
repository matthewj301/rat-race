#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
#############################################################################################################
[include RatOS.cfg]

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################

#### COMMON #####
[gcode_macro RatOS]
variable_relative_extrusion: True                # True|False = enable relative extrusion mode
variable_force_absolute_position: False           # True|False = force absolute positioning before the print starts
variable_preheat_extruder: True                   # True|False = enable preheating for inductive probes
variable_preheat_extruder_temp: 150               # int = the preheating nozzle temperature
variable_end_print_motors_off: True               # True|False = Keeps the motors for none IDEX printer on after a print ends
variable_macro_travel_speed: 600                  # int = xy macro travel move speed  
variable_macro_travel_accel: 8000                 # int = xy macro travel move acceleration
variable_macro_z_speed: 30                        # int = z macro travel move speed
variable_bed_margin_x: [0, 0]                     # [float, float] = left and right bed margin
variable_bed_margin_y: [0, 0]                     # [float, float] = front and back bed margin
variable_start_print_heat_chamber_bed_temp: 110   # int = bed temperature during chamber preheating

#### HOMING ####
[gcode_macro RatOS]
variable_homing: "endstops"                    # endstops|sensorless = axis homing method
variable_z_probe: "static"                     # static|stowable = z-probe type
variable_home_y_first: True
variable_safe_home_x: "middle"                 # float|middle = z-homing x location
variable_safe_home_y: "middle"                 # float|middle = z-homing y location
variable_driver_type_x: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_driver_type_y: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_sensorless_x_current: 0.4             # float = stepper driver run current for sensorless x-homing
variable_sensorless_y_current: 0.4             # float = stepper driver run current for sensorless y-homing

#### MESH ####
[gcode_macro RatOS]
variable_calibrate_bed_mesh: True                # True|False = enable bed meshing
variable_adaptive_mesh: True                     # True|False = enable adaptive bed meshing
variable_adaptive_prime_offset_threshold: -1.0   # float = threshold value used for probing sanity checks

#### PARKING ####
[gcode_macro RatOS]
variable_start_print_park_in: "front"     # back|front|center = gantry parking position before the print starts
variable_start_print_park_z_height: 20   # float = toolhead parking z-position before the print starts
variable_end_print_park_in: "back"       # back|front|center = gantry parking position after the print has finished
variable_pause_print_park_in: "front"     # back|front|center = gantry parking position if the print has paused
variable_end_print_park_z_hop: 20        # float = toolhead z-hop after the print has finished

#### PRIMING ####
[gcode_macro RatOS]
variable_nozzle_priming: "false"             # primeblob|false = To prime, or not to prime, that is the question.
variable_nozzle_prime_start_x: "283"             # min|max|float = non IDEX priming x-location
variable_nozzle_prime_start_y: "0.5"             # min|max|float = non IDEX priming y-location
variable_nozzle_prime_direction: "auto"          # auto|forwards|backwards = non IDEX priming y-direction
variable_nozzle_prime_bridge_fan: 102            # int = priming fan speed 0-255


#### PRIME_BLOB ####
[gcode_macro PRIME_BLOB]
variable_x_offset: 5   # the prime blob x-margin 

#### BEACON ####
[gcode_macro RatOS]
variable_beacon_bed_mesh_scv: 25                         # int = square corner velocity for beacon proximity bed meshing
variable_beacon_contact_z_homing: False                  # True|False = use beacon contact for z-homing
variable_beacon_contact_z_calibration: True             # True|False = use beacon contact z-calibration
variable_beacon_contact_calibration_location: "center"   # center|front|corner = beacon contact z-calibration location
variable_beacon_contact_calibrate_margin_x: 30           # float = use beacon contact z-calibration x-margin 
variable_beacon_contact_bed_mesh: False                  # True|False = use beacon contact for bed meshing
variable_beacon_contact_bed_mesh_samples: 2              # int = beacon contact bed mesh probe samples
variable_beacon_contact_z_tilt_adjust: False             # True|False = use beacon contact for z-tilting
variable_beacon_contact_z_tilt_adjust_samples: 2         # int = beacon contact z-tilt probe samples
variable_beacon_contact_prime_probing: True             # True|False = use beacon contact to probe for prime blobs
variable_beacon_contact_calibration_temp: 150            # int = beacon contact z-calibration nozzle temperature
variable_beacon_contact_expansion_compensation: True    # True|False = use nozzle thermal expansion compensation
variable_beacon_contact_wipe_before_calibrate: True      # enables a nozzle wipe at Y0 before doing the contact calibration
variable_beacon_scan_compensation_enable: True
variable_bed_heat_soak_time: 240
variable_hotend_heat_soak_time: 120

#### CHAMBER HEATING ####
[gcode_macro RatOS]
variable_chamber_heater_enable: True                      # True|False = enable chamber heater control
variable_chamber_heater_bed_temp: 115                     # int = bed temperature during chamber preheating
variable_chamber_heater_preheating_temp: 150              # int = the temp the generic_heater is set to when preheating the chamber
variable_chamber_heater_heating_temp_offset: 25           # int = the temp offset for the generic_heater, in addition to the target chamber_temp, while printing
variable_chamber_heater_control_external_heater: False    # True|False = automatic heater control for external heater devices
variable_chamber_heater_air_circulation_enable: True      # True|False = uses the part cooling to blow air from the top of the chamber to the bottom when preheating the chamber
variable_chamber_heater_air_circulation_fan_speed: 0.50   # float = the part cooling fan speed that is used to circulate the air when preheating the chamber
variable_chamber_heater_air_circulation_y_pos: 150          # float = toolhead y-pos when circulating the air
variable_chamber_heater_air_circulation_z_pos: 50        # float = toolhead z-pos when circulating the air
variable_chamber_heater_extra_fan_speed: 1.0              # float = the extra chamber heater fan that is used to circulate the air when preheating the chamber

#### CHAMBER FILTER ####
[gcode_macro RatOS]
variable_chamber_filter_enable: True                     # True|False = enable chamber filter control
variable_chamber_filter_speed: 1.0                       # float = chamber filter fan speed.
variable_chamber_filter_enable_at: "before_print_start"   # before_print_start|after_print_start|print_end = when to enable the filter
variable_chamber_filter_disable_period: 280              # int = disable fan after X seconds after the print ends
variable_chamber_filter_disable_bed_temp: 0              # int = wait for XÂ°C bed temp after the print ends before disabling the filter

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: Follow along from step 6 in the official beacon guide
###    https://docs.beacon3d.com/quickstart/#6-calibrate-beacon
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################
[exclude_object]
[include timelapse.cfg]
[include custom/tuning/*.cfg]
[include custom/tuning/linear_vibrations/*.cfg]

[include mmu/base/*.cfg]
[include custom/mmu/*.cfg]


[include custom/printers/v-core-3/v-core-3.cfg]
[include custom/toolheads/vz-toolhead.cfg]
[include custom/awd/awd.cfg]

[include custom/fans/*.cfg]

[include custom/servos/*.cfg]

[include custom/sensors/chamber_thermistors.cfg]

[include custom/macros.cfg]



#---------------------------------------------------- Z -----------------------------------------------------
# The left Z motor for the kinematic bed
# Connected to MOTOR 5 on Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------
[stepper_z]
position_min: -5
position_max: 300

#---------------------------------------------------- Z1 ----------------------------------------------------
# The rear Z motor for the kinematic bed
# Connected to MOTOR 6 on Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------

#---------------------------------------------------- Z2 ----------------------------------------------------
# The right Z motor for the kinematic bed
# Connected to MOTOR 7 on Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for pushing filament through the toolhead
# Connected to Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------
[extruder]
nozzle_diameter: 0.6
#control: pid
#pid_kp: 28.413
#pid_ki: 1.334
#pid_kd: 151.300


[heater_bed]
pwm_cycle_time: 0.02088 #47.9Hz
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114



# REMEMBER TO CALIBRATE YOUR BEACON!
# Follow along from step 6 in the official beacon guide https://docs.beacon3d.com/quickstart/#6-calibrate-beacon

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 70.879
#*# pid_ki = 2.448
#*# pid_kd = 512.985
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.368
#*# pid_ki = 0.752
#*# pid_kd = 100.298
#*#
#*# [beacon model default]
#*# model_coef = 1.4011280220610771,
#*# 	1.7144494071308094,
#*# 	0.7728091661679094,
#*# 	0.3759587978383178,
#*# 	0.28243421006203145,
#*# 	0.34366201836380483,
#*# 	0.08895427130147053,
#*# 	-0.1330393692691729,
#*# 	0.05532710196882826,
#*# 	0.10106189497802141
#*# model_domain = 1.780658714774324e-07,1.9232443732768056e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 79.974001
#*# model_offset = 0.00000
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 97.6
#*# shaper_type_y = ei
#*# shaper_freq_y = 72.8
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	-0.009931, -0.014102, -0.007877, -0.009101, -0.007390, -0.008858, -0.010837, -0.017330, -0.020153, -0.021753, -0.019549, -0.026994, -0.031685, -0.030250, -0.017590, -0.006934, -0.007699
#*# 	-0.014192, -0.005002, 0.001755, 0.002598, 0.006034, 0.005880, 0.000760, -0.003053, -0.002827, -0.007207, -0.004756, -0.010218, -0.021844, -0.017856, -0.002945, 0.001924, -0.002686
#*# 	-0.022158, -0.010596, -0.005057, -0.000926, 0.002013, 0.003803, 0.000574, -0.003951, -0.005970, -0.004711, -0.007429, -0.011160, -0.021283, -0.017916, -0.005431, 0.004178, 0.001321
#*# 	-0.020812, -0.013982, -0.006086, 0.004405, 0.004255, 0.004887, 0.004245, 0.002206, -0.000992, 0.000641, -0.001811, -0.012100, -0.017598, -0.015745, -0.006633, 0.004903, -0.000731
#*# 	-0.027965, -0.016775, -0.004134, 0.005951, 0.008115, 0.009170, 0.006236, 0.000177, -0.000683, 0.002399, -0.002293, -0.008670, -0.015964, -0.014628, -0.005220, 0.005924, 0.003961
#*# 	-0.007953, 0.005129, 0.022249, 0.026641, 0.031836, 0.032689, 0.021202, 0.019864, 0.025713, 0.023566, 0.021860, 0.015347, 0.001438, 0.002021, 0.010805, 0.018677, 0.015019
#*# 	-0.010036, 0.005048, 0.017819, 0.017407, 0.026133, 0.022197, 0.017444, 0.010452, 0.017219, 0.016673, 0.016021, 0.012540, 0.000899, -0.003171, 0.003018, 0.009386, 0.011520
#*# 	-0.012739, 0.000820, 0.004612, 0.014909, 0.016800, 0.013040, 0.010106, 0.007901, 0.009468, 0.011567, 0.011151, 0.000014, -0.006646, -0.010146, -0.006104, -0.001030, -0.000349
#*# 	-0.006187, 0.003575, 0.011204, 0.018446, 0.021631, 0.018795, 0.018078, 0.011710, 0.016780, 0.016628, 0.020201, 0.012058, 0.003356, 0.000357, 0.000928, 0.009780, 0.007977
#*# 	-0.000264, 0.010395, 0.014833, 0.020364, 0.024414, 0.024716, 0.018402, 0.018255, 0.021203, 0.023491, 0.023605, 0.018713, 0.001707, -0.001137, 0.006258, 0.010858, 0.011817
#*# 	-0.009914, 0.001651, 0.006637, 0.009656, 0.017497, 0.018220, 0.010992, 0.007841, 0.011308, 0.011150, 0.015253, 0.010539, -0.003027, -0.004027, -0.002535, 0.002919, 0.005038
#*# 	-0.010859, -0.005189, 0.001672, 0.012386, 0.016234, 0.013068, 0.010481, 0.006669, 0.008168, 0.012946, 0.011540, 0.002562, -0.007854, -0.009281, -0.007156, 0.001536, 0.002734
#*# 	-0.019326, -0.011648, -0.000784, 0.008533, 0.013720, 0.013521, 0.013554, 0.004019, 0.004099, 0.005652, 0.006805, -0.001005, -0.006924, -0.013820, -0.015283, -0.005064, 0.001654
#*# 	-0.018984, -0.009347, 0.002293, 0.010666, 0.018595, 0.017261, 0.016645, 0.012019, 0.010432, 0.011717, 0.012462, 0.002553, -0.006384, -0.016818, -0.010035, -0.002709, 0.002408
#*# 	-0.026637, -0.014227, -0.006358, 0.000583, 0.009040, 0.014877, 0.009535, 0.004915, 0.004634, 0.000275, 0.004180, 0.000443, -0.011967, -0.019017, -0.020735, -0.011212, -0.007840
#*# 	-0.027889, -0.018180, -0.012344, -0.004164, 0.005014, 0.008351, 0.009218, 0.000760, -0.000988, 0.002522, 0.003168, -0.004556, -0.014844, -0.021637, -0.024491, -0.013163, -0.008299
#*# 	-0.018325, -0.006048, 0.000432, 0.010950, 0.016159, 0.021136, 0.020610, 0.015392, 0.012164, 0.017803, 0.019209, 0.012317, 0.004020, -0.000459, -0.011289, 0.000978, 0.007851
#*# 	-0.012770, -0.003114, 0.004687, 0.013366, 0.016266, 0.019487, 0.017971, 0.017749, 0.014395, 0.019559, 0.016484, 0.010073, 0.005380, -0.005241, -0.011246, -0.003202, 0.001211
#*# 	-0.028164, -0.018924, -0.007272, -0.003056, 0.000134, 0.004568, 0.002864, 0.002578, 0.007503, 0.005881, 0.005764, 0.002400, -0.007670, -0.016846, -0.021238, -0.017261, -0.011208
#*# 	-0.025671, -0.015092, -0.003188, 0.000061, 0.008277, 0.008529, 0.009141, 0.008829, 0.011590, 0.010210, 0.013959, 0.003124, -0.006894, -0.016482, -0.023905, -0.019142, -0.011512
#*# 	-0.029789, -0.016547, -0.006340, 0.002845, 0.007849, 0.012125, 0.015794, 0.008917, 0.010894, 0.011242, 0.008315, 0.000575, -0.008570, -0.019178, -0.034268, -0.027011, -0.018151
#*# 	-0.033448, -0.019784, -0.004637, 0.002487, 0.009965, 0.013872, 0.013376, 0.007927, 0.008539, 0.010586, 0.007095, -0.007281, -0.015444, -0.030819, -0.039030, -0.031747, -0.022257
#*# 	-0.031107, -0.014462, -0.004338, 0.007281, 0.011727, 0.020155, 0.015776, 0.014409, 0.014487, 0.015062, 0.007707, -0.001669, -0.014958, -0.026860, -0.032826, -0.028417, -0.018029
#*# 	-0.023241, -0.008962, 0.008750, 0.013273, 0.019022, 0.021817, 0.018886, 0.016810, 0.017140, 0.013482, 0.007500, -0.002689, -0.017022, -0.024661, -0.028181, -0.023758, -0.019344
#*# 	-0.026453, -0.010318, -0.001274, 0.008352, 0.011808, 0.017251, 0.017111, 0.013616, 0.012880, 0.009529, 0.002735, -0.005868, -0.015024, -0.026202, -0.028735, -0.029361, -0.026218
#*# x_count = 17
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 48.0713
#*# max_x = 251.797
#*# min_y = 35.0
#*# max_y = 260.0
#*#
#*# [bed_mesh Contact]
#*# version = 1
#*# points =
#*# 	-0.083125, -0.043750, -0.024844, 0.016406, 0.014844, 0.036719, 0.033594, 0.046250, 0.030469, 0.019375, 0.006719, -0.006875, -0.020938, -0.054219, -0.122500
#*# 	-0.078594, -0.024531, -0.026406, 0.003750, 0.017031, 0.040625, 0.038594, 0.027187, 0.033281, 0.012656, -0.002813, -0.002656, -0.004688, -0.047500, -0.119844
#*# 	-0.043594, -0.009063, 0.029844, 0.034375, 0.052031, 0.055469, 0.055312, 0.055312, 0.043594, 0.041250, 0.023437, 0.023281, 0.022187, -0.034375, -0.094688
#*# 	-0.059375, -0.045469, -0.010938, 0.003906, 0.030781, 0.055937, 0.054531, 0.032187, 0.019062, 0.018281, -0.007344, -0.007656, -0.003750, -0.045469, -0.100625
#*# 	-0.013906, 0.003437, 0.029375, 0.070469, 0.070156, 0.076250, 0.083750, 0.067187, 0.051094, 0.035469, 0.041719, 0.031250, 0.027969, -0.041719, -0.090156
#*# 	-0.048906, -0.010156, 0.033281, 0.046250, 0.082656, 0.077812, 0.050937, 0.052500, 0.039375, 0.030000, 0.011250, 0.020625, 0.029219, -0.027500, -0.081094
#*# 	-0.037969, -0.011406, 0.014219, 0.065156, 0.073125, 0.068906, 0.067031, 0.038437, 0.034687, 0.034219, 0.028750, 0.026094, 0.029531, -0.023750, -0.070625
#*# 	-0.076563, -0.045625, 0.008281, 0.031875, 0.042031, 0.068594, 0.054062, 0.038125, 0.032969, 0.029687, 0.017500, 0.021875, -0.003750, -0.039375, -0.086094
#*# 	-0.082813, -0.040000, 0.023906, 0.032812, 0.055469, 0.082500, 0.066250, 0.029219, 0.033125, 0.038594, 0.029219, 0.016719, -0.000469, -0.042344, -0.087500
#*# 	-0.053438, -0.019844, 0.034687, 0.042344, 0.078906, 0.072656, 0.075781, 0.049844, 0.054375, 0.055469, 0.037812, 0.018281, 0.016562, -0.027500, -0.057188
#*# 	-0.049531, -0.021406, -0.000469, 0.051406, 0.070000, 0.075156, 0.078281, 0.073281, 0.080625, 0.050312, 0.054844, 0.025937, 0.019062, -0.018281, -0.061719
#*# 	-0.046563, -0.039375, 0.032656, 0.042344, 0.076562, 0.076406, 0.095469, 0.075937, 0.067969, 0.047187, 0.027500, 0.025312, 0.029219, -0.033594, -0.082500
#*# 	-0.017344, -0.017188, 0.019062, 0.068281, 0.082187, 0.104844, 0.081719, 0.094375, 0.098750, 0.081875, 0.064062, 0.058750, 0.041719, 0.023281, -0.051719
#*# 	-0.044531, -0.042813, 0.022344, 0.033281, 0.043281, 0.070625, 0.062656, 0.081875, 0.097656, 0.072031, 0.062656, 0.034844, 0.023906, -0.008281, -0.058594
#*# 	-0.049688, -0.068906, -0.021563, 0.039844, 0.035156, 0.062656, 0.069062, 0.068750, 0.068594, 0.073437, 0.038125, 0.031719, 0.027656, -0.010469, -0.049531
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 5.0
#*# max_x = 289.9
#*# min_y = 35.0
#*# max_y = 239.26
