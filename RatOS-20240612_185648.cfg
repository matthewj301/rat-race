# WARNING. THIS FILE IS GENERATED BY THE RATOS CONFIGURATOR.
# CHANGES YOU MAKE HERE WILL BE OVERWRITTEN. KEEP YOUR CHANGES IN PRINTER.CFG.
# Config generated for Rat Rig V-Core 3 300
# Documentation: https://os.ratrig.com

#############################################################################################################
### CONTROLBOARD & TOOLBOARD
#############################################################################################################
[include RatOS/boards/rpi/config.cfg]

[board_pins btt-octopus-max-ez]
aliases:
	#----------------------------------------------- X motor pins -----------------------------------------------
	# Assigned to slot: "MOTOR 1"
	#------------------------------------------------------------------------------------------------------------
	x_step_pin=PC13,
	x_dir_pin=PC14,
	x_enable_pin=PE6,
	x_uart_pin=PG14,
	x_diag_pin=PF0,
	x_endstop_pin=PF0,
	#----------------------------------------------- Y motor pins -----------------------------------------------
	# Assigned to slot: "MOTOR 2"
	#------------------------------------------------------------------------------------------------------------
	y_step_pin=PE4,
	y_dir_pin=PE5,
	y_enable_pin=PE3,
	y_uart_pin=PG13,
	y_diag_pin=PF2,
	y_endstop_pin=PF2,
	#----------------------------------------------- Z motor pins -----------------------------------------------
	# Assigned to slot: "MOTOR 5"
	#------------------------------------------------------------------------------------------------------------
	z0_step_pin=PB5,
	z0_dir_pin=PB4,
	z0_enable_pin=PB6,
	z0_uart_pin=PG10,
	z0_diag_pin=PF1,
	#---------------------------------------------- Z1 motor pins -----------------------------------------------
	# Assigned to slot: "MOTOR 6"
	#------------------------------------------------------------------------------------------------------------
	z1_step_pin=PG15,
	z1_dir_pin=PB3,
	z1_enable_pin=PD5,
	z1_uart_pin=PG9,
	z1_diag_pin=PC15,
	#---------------------------------------------- Z2 motor pins -----------------------------------------------
	# Assigned to slot: "MOTOR 7"
	#------------------------------------------------------------------------------------------------------------
	z2_step_pin=PD3,
	z2_dir_pin=PD2,
	z2_enable_pin=PD4,
	z2_uart_pin=PD7,
	#------------------------------------------- EXTRUDER motor pins --------------------------------------------
	# Assigned to slot: "MOTOR 3"
	#------------------------------------------------------------------------------------------------------------
	e_step_pin=PE1,
	e_dir_pin=PE0,
	e_enable_pin=PE2,
	e_uart_pin=PG12,
	e_diag_pin=PF4,
	#----------------------------------------------- GENERAL PINS -----------------------------------------------
	e_heater_pin=PF6,
	e_sensor_pin=PB0,
	stepper_spi_mosi_pin=PE14,
	stepper_spi_miso_pin=PE13,
	stepper_spi_sclk_pin=PE12,
	bltouch_sensor_pin=PB15,
	bltouch_control_pin=PB14,
	probe_pin=PB15,
	fan_part_cooling_pin=PA6,
	fan_controller_board_pin=PA4,
	heater_bed_heating_pin=PF5,
	heater_bed_sensor_pin=PB1,
	4p_fan_part_cooling_pin=PA1,
	4p_fan_part_cooling_tach_pin=PC3,
	4p_toolhead_cooling_pin=PF8,
	4p_toolhead_cooling_tach_pin=PC1,
	4p_controller_board_pin=PA2,
	4p_controller_board_tach_pin=PC2,
    fan_toolhead_cooling_pin=PA5,

[mcu]
serial: /dev/RatOS/btt-octopus-max-ez

[temperature_sensor Octopus_Max_EZ_V1.0]
sensor_type: temperature_mcu


#############################################################################################################
### BASE SETUP
#############################################################################################################
[include RatOS/homing.cfg]
[include RatOS/macros.cfg]
[include RatOS/shell-macros.cfg]
[include RatOS/printers/v-core-3/v-core-3.cfg]
[include RatOS/printers/v-core-3/macros.cfg]
[include RatOS/printers/v-core-3/300.cfg]


# Toolhead Definition
# VZ-Toolhead (VZ-Hextrudort Plus extruder, Goliath hotend, Beacon probe)
#[include custom/toolheads/vz-toolhead.cfg]

# ADXL345 resonance testing configuration
[resonance_tester]
accel_chip_x: beacon
accel_chip_y: beacon
probe_points:
	150,150,20

#############################################################################################################
### STEPPER MOTORS, DRIVERS & SPEED LIMITS
#############################################################################################################
#[include custom/awd/awd.cfg]

#---------------------------------------------------- Z -----------------------------------------------------
# The left Z motor for the kinematic bed
# Connected to MOTOR 5 on Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------
[tmc2209 stepper_z]
stealthchop_threshold: 0
interpolate: False
uart_pin: z0_uart_pin
run_current: 1.6
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 0
driver_HSTRT: 6
sense_resistor: 0.11

[stepper_z]
step_pin: z0_step_pin
dir_pin: z0_dir_pin
enable_pin: !z0_enable_pin
microsteps: 64
full_steps_per_rotation: 200
rotation_distance: 4
homing_speed: 10
endstop_pin: probe:z_virtual_endstop

#---------------------------------------------------- Z1 ----------------------------------------------------
# The rear Z motor for the kinematic bed
# Connected to MOTOR 6 on Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------
[tmc2209 stepper_z1]
stealthchop_threshold: 0
interpolate: False
uart_pin: z1_uart_pin
run_current: 1.6
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 0
driver_HSTRT: 6
sense_resistor: 0.11

[stepper_z1]
step_pin: z1_step_pin
dir_pin: z1_dir_pin
enable_pin: !z1_enable_pin
microsteps: 64
full_steps_per_rotation: 200
rotation_distance: 4

#---------------------------------------------------- Z2 ----------------------------------------------------
# The right Z motor for the kinematic bed
# Connected to MOTOR 7 on Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------
[tmc2209 stepper_z2]
stealthchop_threshold: 0
interpolate: False
uart_pin: z2_uart_pin
run_current: 1.6
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 0
driver_HSTRT: 6
sense_resistor: 0.11

[stepper_z2]
step_pin: z2_step_pin
dir_pin: z2_dir_pin
enable_pin: !z2_enable_pin
microsteps: 64
full_steps_per_rotation: 200
rotation_distance: 4


[printer]
max_velocity: 1100
max_accel: 60000
minimum_cruise_ratio: 0.5
max_z_velocity: 50
max_z_accel: 600
square_corner_velocity: 5


[bed_mesh]
speed: 600

[z_tilt]
speed: 600


#############################################################################################################
### HOMING
#############################################################################################################
[include RatOS/z-probe/beacon.cfg]


# Physical X endstop configuration
#[stepper_x]
#endstop_pin: PF2
#[gcode_macro RatOS]
#variable_homing_x: "endstop"

# Physical Y endstop configuration
#[stepper_y]
#endstop_pin: PF4
#[gcode_macro RatOS]
#variable_homing_y: "endstop"


#############################################################################################################
### FANS
#############################################################################################################
#[include custom/fans/*]


#############################################################################################################
### CUSTOM
#############################################################################################################
#[include timelapse.cfg]

#[include mmu/base/*.cfg]

#[include custom/servos/*]
#[include custom/sensors/chamber_thermistors.cfg]

# Requires investigation - something wrong with the extruder definition
#[include custom/autotune.cfg]



#############################################################################################################
### MACRO CONFIGURATION
#############################################################################################################
[gcode_macro T0]
variable_active: True
variable_color: "7bff33"                                  # Used in frontends
variable_hotend_type: "UHF"
variable_has_cht_nozzle: True
variable_cooling_position_to_nozzle_distance: 40          # heatbreak length from cold zone to nozzle
variable_tooolhead_sensor_to_extruder_gear_distance: 15   # distance in mm from the sensor to the extruder gear
variable_extruder_gear_to_cooling_position_distance: 30   # distance in mm from the extruder gear to the end of the hotend cold zone
variable_filament_loading_nozzle_offset: -5
variable_filament_grabbing_length: 5
variable_filament_grabbing_speed: 1
variable_enable_insert_detection: False                    # enables filament sensor insert detection 
variable_enable_runout_detection: False                    # enables filament sensor runout detection 
variable_enable_clog_detection: False                      # enables filament sensor clog detection 
variable_unload_after_runout: False                        # unload filament after a runout has been detected
variable_purge_after_load: 0
variable_purge_before_unload: 0
variable_extruder_load_speed: 60
variable_filament_load_speed: 10
variable_standby: False
variable_temperature_offset: 0                            # hotend temperature offset
variable_has_oozeguard: False                             # toolhead has a oozeguard
variable_has_front_arm_nozzle_wiper: False                # toolhead has front arm nozzle wipers
variable_resume_after_insert: False                       # resumes the print after inserting new filament
gcode:
	{% set x = params.X|default(-1.0)|float %}
	{% set y = params.Y|default(-1.0)|float %}
	{% set z = params.Z|default(0.0)|float %}
	{% set s = params.S|default(1)|int %}
	{% if printer["gcode_macro _SELECT_TOOL"] is defined %}
		_SELECT_TOOL T=0 X={x} Y={y} Z={z} TOOLSHIFT={s}
	{% endif %}

# Macro variable overrides
[gcode_macro RatOS]
variable_bed_margin_x: [0, 0]
variable_bed_margin_y: [0, 0]
variable_x_driver_types: ["tmc5160", "tmc5160"]
variable_x_axes: ["x", "x1"]
variable_y_driver_types: ["tmc5160", "tmc5160"]
variable_y_axes: ["y", "y1"]
variable_z_driver_types: ["tmc2209", "tmc2209", "tmc2209"]
variable_z_axes: ["z", "z1", "z2"]

# Save variables
[save_variables]
filename: /home/pi/printer_data/config/ratos-variables.cfg