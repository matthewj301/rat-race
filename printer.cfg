#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
#############################################################################################################
[include RatOS.cfg]

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################

#### SLICERS ####
[ratos]
allow_unsupported_slicer_versions: True

#### COMMON #####
[gcode_macro RatOS]
variable_relative_extrusion: True                # True|False = enable relative extrusion mode
variable_force_absolute_position: False           # True|False = force absolute positioning before the print starts
variable_preheat_extruder: True                   # True|False = enable preheating for inductive probes
variable_preheat_extruder_temp: 150               # int = the preheating nozzle temperature
variable_end_print_motors_off: True               # True|False = Keeps the motors for none IDEX printer on after a print ends
variable_macro_travel_speed: 600                  # int = xy macro travel move speed  
variable_macro_travel_accel: 8000                 # int = xy macro travel move acceleration
variable_macro_z_speed: 30                        # int = z macro travel move speed
variable_bed_margin_x: [0, 0]                     # [float, float] = left and right bed margin
variable_bed_margin_y: [0, 0]                     # [float, float] = front and back bed margin
variable_start_print_heat_chamber_bed_temp: 110   # int = bed temperature during chamber preheating

#### HOMING ####
[gcode_macro RatOS]
variable_homing: "endstops"                    # endstops|sensorless = axis homing method
variable_z_probe: "static"                     # static|stowable = z-probe type
variable_home_y_first: True
variable_safe_home_x: "middle"                 # float|middle = z-homing x location
variable_safe_home_y: "middle"                 # float|middle = z-homing y location
variable_driver_type_x: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_driver_type_y: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_sensorless_x_current: 0.4             # float = stepper driver run current for sensorless x-homing
variable_sensorless_y_current: 0.4             # float = stepper driver run current for sensorless y-homing

#### MESH ####
[gcode_macro RatOS]
variable_calibrate_bed_mesh: True                # True|False = enable bed meshing
variable_adaptive_mesh: True                     # True|False = enable adaptive bed meshing
variable_adaptive_prime_offset_threshold: -1.0   # float = threshold value used for probing sanity checks

#### PARKING ####
[gcode_macro RatOS]
variable_start_print_park_in: "front"     # back|front|center = gantry parking position before the print starts
variable_start_print_park_z_height: 20   # float = toolhead parking z-position before the print starts
variable_end_print_park_in: "back"       # back|front|center = gantry parking position after the print has finished
variable_pause_print_park_in: "front"     # back|front|center = gantry parking position if the print has paused
variable_end_print_park_z_hop: 20        # float = toolhead z-hop after the print has finished

#### PRIMING ####
[gcode_macro RatOS]
variable_nozzle_priming: "false"             # primeblob|false = To prime, or not to prime, that is the question.
variable_nozzle_prime_start_x: "283"             # min|max|float = non IDEX priming x-location
variable_nozzle_prime_start_y: "0.5"             # min|max|float = non IDEX priming y-location
variable_nozzle_prime_direction: "auto"          # auto|forwards|backwards = non IDEX priming y-direction
variable_nozzle_prime_bridge_fan: 102            # int = priming fan speed 0-255


#### PRIME_BLOB ####
[gcode_macro PRIME_BLOB]
variable_x_offset: 5   # the prime blob x-margin 

#### BEACON ####
[gcode_macro RatOS]
variable_beacon_bed_mesh_scv: 25                         # int = square corner velocity for beacon proximity bed meshing
variable_beacon_contact_z_homing: False                  # True|False = use beacon contact for z-homing
variable_beacon_contact_start_print_true_zero: True             # True|False = use beacon contact z-calibration
variable_beacon_contact_bed_mesh: False                  # True|False = use beacon contact for bed meshing
variable_beacon_contact_bed_mesh_samples: 2              # int = beacon contact bed mesh probe samples
variable_beacon_contact_z_tilt_adjust: False             # True|False = use beacon contact for z-tilting
variable_beacon_contact_z_tilt_adjust_samples: 2         # int = beacon contact z-tilt probe samples
variable_beacon_contact_prime_probing: True             # True|False = use beacon contact to probe for prime blobs
variable_beacon_contact_true_zero_temp: 150            # int = beacon contact z-calibration nozzle temperature
variable_beacon_contact_expansion_compensation: True    # True|False = use nozzle thermal expansion compensation
variable_beacon_contact_wipe_before_true_zero: True      # enables a nozzle wipe at Y0 before doing the contact calibration
variable_beacon_scan_compensation_enable: True
variable_bed_heat_soak_time: 240
variable_hotend_heat_soak_time: 120

#### CHAMBER HEATING ####
[gcode_macro RatOS]
variable_chamber_heater_enable: True                      # True|False = enable chamber heater control
variable_chamber_heater_bed_temp: 115                     # int = bed temperature during chamber preheating
variable_chamber_heater_preheating_temp: 150              # int = the temp the generic_heater is set to when preheating the chamber
variable_chamber_heater_heating_temp_offset: 25           # int = the temp offset for the generic_heater, in addition to the target chamber_temp, while printing
variable_chamber_heater_control_external_heater: False    # True|False = automatic heater control for external heater devices
variable_chamber_heater_air_circulation_enable: True      # True|False = uses the part cooling to blow air from the top of the chamber to the bottom when preheating the chamber
variable_chamber_heater_air_circulation_fan_speed: 0.50   # float = the part cooling fan speed that is used to circulate the air when preheating the chamber
variable_chamber_heater_air_circulation_y_pos: 150          # float = toolhead y-pos when circulating the air
variable_chamber_heater_air_circulation_z_pos: 50        # float = toolhead z-pos when circulating the air
variable_chamber_heater_extra_fan_speed: 1.0              # float = the extra chamber heater fan that is used to circulate the air when preheating the chamber

#### CHAMBER FILTER ####
[gcode_macro RatOS]
variable_chamber_filter_enable: True                     # True|False = enable chamber filter control
variable_chamber_filter_speed: 1.0                       # float = chamber filter fan speed.
variable_chamber_filter_enable_at: "before_print_start"   # before_print_start|after_print_start|print_end = when to enable the filter
variable_chamber_filter_disable_period: 280              # int = disable fan after X seconds after the print ends
variable_chamber_filter_disable_bed_temp: 0              # int = wait for XÂ°C bed temp after the print ends before disabling the filter

### SKEW ###
variable_skew_profile: "CaliFlower"

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: Follow along from step 6 in the official beacon guide
###    https://docs.beacon3d.com/quickstart/#6-calibrate-beacon
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################
# Enable arcs support
[gcode_arcs]
resolution: 0.1
[exclude_object]
[include timelapse.cfg]
[include custom/tuning/*.cfg]
[include custom/tuning/linear_vibrations/*.cfg]

[include mmu/base/*.cfg]
[include custom/mmu/*.cfg]


[include custom/printers/v-core-3/v-core-3.cfg]

[include /home/pi/printer_data/config/custom/toolheads/tallboy.cfg]
[include /home/pi/printer_data/config/custom/steppers/z-axis/steppers.cfg]
[include /home/pi/printer_data/config/custom/awd/awd.cfg]


[include custom/fans/*.cfg]

[include custom/servos/*.cfg]

[include custom/sensors/chamber_thermistors.cfg]
[include custom/sensors/water_cooling_thermistor.cfg]


[include custom/macros.cfg]

#[include custom/expanders/*.cfg]



#---------------------------------------------------- Z -----------------------------------------------------
# The left Z motor for the kinematic bed
# Connected to MOTOR 5 on Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------
[stepper_z]
position_min: -5
position_max: 300

#---------------------------------------------------- Z1 ----------------------------------------------------
# The rear Z motor for the kinematic bed
# Connected to MOTOR 6 on Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------

#---------------------------------------------------- Z2 ----------------------------------------------------
# The right Z motor for the kinematic bed
# Connected to MOTOR 7 on Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for pushing filament through the toolhead
# Connected to Octopus Max EZ V1.0
#------------------------------------------------------------------------------------------------------------
[extruder]
nozzle_diameter: 0.5
#control: pid
#pid_kp: 28.413
#pid_ki: 1.334
#pid_kd: 151.300


[heater_bed]
pwm_cycle_time: 0.02088 #47.9Hz
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114



# REMEMBER TO CALIBRATE YOUR BEACON!
# Follow along from step 6 in the official beacon guide https://docs.beacon3d.com/quickstart/#6-calibrate-beacon

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 70.879
#*# pid_ki = 2.448
#*# pid_kd = 512.985
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 18.001
#*# pid_ki = 0.750
#*# pid_kd = 108.011
#*#
#*# [beacon model default]
#*# model_coef = 1.4343017673867777,
#*# 	1.7481052946351758,
#*# 	0.7731229776963371,
#*# 	0.44717738550632513,
#*# 	0.38578181020854835,
#*# 	0.2478482224081775,
#*# 	-0.11302091362432057,
#*# 	-0.13503044834140077,
#*# 	0.12060218735322513,
#*# 	0.09423504955499148
#*# model_domain = 1.8045659950658398e-07,1.92504211757093e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 76.123671
#*# model_offset = 0.00000
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 97.2
#*# shaper_type_y = mzv
#*# shaper_freq_y = 77.0
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	-0.025866, -0.008617, -0.002960, -0.001329, -0.003070, 0.012969, 0.028947, -0.013966, -0.034824, -0.039737
#*# 	0.017898, 0.004384, 0.000057, -0.001205, 0.001124, 0.015713, 0.031443, 0.011479, -0.000993, -0.009329
#*# 	0.011954, 0.000610, -0.003077, -0.000085, 0.015905, 0.017720, 0.015238, 0.023953, 0.013255, -0.019116
#*# 	0.012314, 0.008182, 0.006681, 0.011602, 0.031129, 0.025221, 0.012437, 0.030816, 0.019938, -0.022212
#*# 	0.046013, 0.041773, 0.041307, 0.041913, 0.043473, 0.041347, 0.037758, 0.036924, 0.027049, 0.006152
#*# 	0.040743, 0.042639, 0.057105, 0.063399, 0.046855, 0.039527, 0.037004, 0.042282, 0.039019, 0.026695
#*# 	0.059494, 0.059836, 0.068021, 0.067722, 0.044278, 0.037449, 0.037737, 0.040122, 0.038858, 0.032957
#*# 	0.080701, 0.084227, 0.078566, 0.068597, 0.049982, 0.045923, 0.046664, 0.040748, 0.037494, 0.034576
#*# 	0.090660, 0.111007, 0.092786, 0.076314, 0.075892, 0.074446, 0.069928, 0.053226, 0.043684, 0.037372
#*# 	0.111353, 0.117203, 0.112010, 0.101986, 0.082799, 0.077114, 0.076181, 0.072312, 0.061874, 0.041338
#*# 	0.119115, 0.115228, 0.104665, 0.094166, 0.083919, 0.080190, 0.078543, 0.075646, 0.069927, 0.058541
#*# 	0.120474, 0.114017, 0.096849, 0.084560, 0.084897, 0.082305, 0.077933, 0.074315, 0.073801, 0.074169
#*# x_count = 10
#*# y_count = 12
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 92.4597
#*# max_x = 207.54
#*# min_y = 92.4597
#*# max_y = 207.54
#*#
#*# [bed_mesh Contact]
#*# version = 1
#*# points =
#*# 	-0.670938, -0.721875, -0.716719, -0.724531, -0.710938, -0.716875, -0.735938, -0.731719, -0.727344, -0.731719, -0.751719, -0.732031, -0.690781, -0.713906, -0.756406
#*# 	-0.566094, -0.600313, -0.601250, -0.594844, -0.606719, -0.597031, -0.600469, -0.633438, -0.646250, -0.647188, -0.647344, -0.683125, -0.637656, -0.615313, -0.642969
#*# 	-0.446250, -0.491094, -0.490625, -0.493750, -0.495469, -0.518438, -0.520781, -0.511875, -0.557969, -0.533750, -0.528281, -0.566406, -0.532188, -0.527188, -0.531719
#*# 	-0.355625, -0.375625, -0.407031, -0.430781, -0.407656, -0.433281, -0.448750, -0.447344, -0.435313, -0.443594, -0.450156, -0.449375, -0.445000, -0.439375, -0.435625
#*# 	-0.248125, -0.290938, -0.322656, -0.313125, -0.310469, -0.323594, -0.333125, -0.365000, -0.355938, -0.329063, -0.364844, -0.371875, -0.354531, -0.362969, -0.368594
#*# 	-0.207969, -0.234063, -0.231250, -0.253594, -0.274219, -0.250156, -0.252031, -0.287813, -0.279844, -0.251719, -0.286406, -0.291563, -0.274531, -0.291094, -0.289375
#*# 	-0.087344, -0.128594, -0.146563, -0.158125, -0.147500, -0.131094, -0.165000, -0.164375, -0.164844, -0.170781, -0.187813, -0.170156, -0.201406, -0.202344, -0.173438
#*# 	-0.017344, -0.077969, -0.084375, -0.084531, -0.069063, -0.066875, -0.077969, -0.113906, -0.093281, -0.093906, -0.135469, -0.133281, -0.129531, -0.123125, -0.129063
#*# 	0.065469, 0.025781, 0.023906, 0.024062, 0.021406, 0.035000, 0.034062, -0.002969, -0.017500, -0.014375, -0.012969, -0.070781, -0.047500, -0.042344, -0.053125
#*# 	0.144219, 0.087187, 0.081406, 0.108281, 0.089531, 0.115625, 0.112187, 0.071719, 0.077344, 0.069531, 0.033437, 0.035156, 0.025937, 0.066719, 0.064844
#*# 	0.230000, 0.189062, 0.193125, 0.192187, 0.197500, 0.202500, 0.193594, 0.169062, 0.193750, 0.192344, 0.148125, 0.122500, 0.151094, 0.144687, 0.146562
#*# 	0.307031, 0.279844, 0.263437, 0.304375, 0.307812, 0.271562, 0.238906, 0.270469, 0.235781, 0.231250, 0.196094, 0.194844, 0.189375, 0.225469, 0.230937
#*# 	0.394219, 0.360156, 0.386875, 0.388750, 0.364219, 0.361719, 0.353125, 0.348281, 0.345469, 0.333437, 0.307656, 0.277187, 0.278437, 0.310625, 0.314531
#*# 	0.542187, 0.467656, 0.467812, 0.466719, 0.443437, 0.451875, 0.431094, 0.436094, 0.435156, 0.428750, 0.390000, 0.362031, 0.347969, 0.394062, 0.426562
#*# 	0.632812, 0.566094, 0.545937, 0.557344, 0.528906, 0.518125, 0.517969, 0.516406, 0.512812, 0.515625, 0.512031, 0.485781, 0.479687, 0.512031, 0.511406
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 5.0
#*# max_x = 289.90000000000003
#*# min_y = 35.0
#*# max_y = 232.39999999999995
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = -0.0038019201011947746
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [skew_correction CaliLantern]
#*# xy_skew = -0.0024324682494497167
#*# xz_skew = 0.0014071482637521737
#*# yz_skew = -0.001237448597314925
