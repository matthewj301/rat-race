# Rat Rig V-core 3 Klipper Config
# Documentation: https://os.ratrig.com

# The first thing you'll need to do is go through this file and comment out / uncomment
# the files and/or settings you need.
# You'll be able to print just fine with this config as it is, but it is recommended
# that you follow these steps to properly calibrate your printer:
# 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
# 1) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
# 2) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
# 3) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html

# Read more about klipper here: https://www.klipper3d.org/Overview.html

#############################################################################################################
### CONTROL BOARD
### Pick the board you have installed and wired in your printer.
#############################################################################################################
[include custom/boards/octopus_max_ez/config.cfg]

#############################################################################################################
### BASE SETUP
#############################################################################################################
[include custom/printers/v-core-3/v-core-3.cfg]
[include RatOS/homing.cfg]
[include RatOS/macros.cfg]
[include RatOS/shell-macros.cfg]
[include RatOS/printers/v-core-3/macros.cfg]


#############################################################################################################
### STEPPER MOTORS, DRIVERS & SPEED LIMITS
### Pick the drivers and stepper motors you're using. See the RatOS documentation for custom combinations.
#############################################################################################################
[include RatOS/printers/v-core-3/steppers.cfg]

# UNCOOLED TMC 2209 + LDO-42STH48-2504AC
#[include RatOS/printers/v-core-3/tmc2209.cfg]
#[include RatOS/printers/v-core-3/speed-limits-basic.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-x.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-y.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z1.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z2.cfg]

# COOLED TMC 2209 + LDO-42STH48-2504AC
# This increases motor torque, positional accuracy and speed limits.
# don't enable this before your printer is fully configured and you have a fan blowing on your stepper drivers.
#[include RatOS/printers/v-core-3/speed-limits-performance.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-x.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-y.cfg]

[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z1.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z2.cfg]

# STEALTH MODE (Enables stealthchop and limits velocity and acceleration)
# NOTE: You still need to include one of the above stepper motor definitions.
# NOTE: This will make your printer quiter but less accurate, it's an inherent side effect of stealthchop.
#[include RatOS/printers/v-core-3/speed-limits-stealth.cfg]
#[include RatOS/printers/v-core-3/tmc2209-stealth.cfg]

#############################################################################################################
### PHYSICAL DIMENSIONS
### Pick your printer size
#############################################################################################################
# Remove the # from your printer size below.
# Similarly add a # in front of [include RatOS/printers/v-core-3/300.cfg] if you have a bigger machine.
#[include RatOS/printers/v-core-3/200.cfg]
[include RatOS/printers/v-core-3/300.cfg]
#[include RatOS/printers/v-core-3/400.cfg]
#[include RatOS/printers/v-core-3/500.cfg]

#############################################################################################################
### HOMING
### Pick your probe and endstops
#############################################################################################################
# BL Touch
#[include RatOS/z-probe/bltouch.cfg]

# Inductive/Capacitive probe
#[include RatOS/z-probe/probe.cfg]

# Beacon probe
#[include RatOS/z-probe/beacon.cfg]

# Euclid probe (please read the RatOS documentation for instructions)
# [include RatOS/z-probe/euclid.cfg]

# Klicky probe (please read the RatOS documentation for instructions)
#[include RatOS/z-probe/klicky/klicky.cfg]
#[include RatOS/z-probe/klicky/unklicky.cfg]

# Physical endstop on X
# [include RatOS/printers/v-core-3/physical-endstop-x.cfg]
# Physical endstop on Y
# [include RatOS/printers/v-core-3/physical-endstop-y.cfg]

# Sensorless homing (Beware: this requires manual tinkering and does not work if your x/y stepper drivers
# have clipped DIAG pins). It is strongly encouraged to use physical endstops if you're a beginner.
# If you still wish to proceed, copy config/templates/sensorless-homing-tmc2209.cfg to the root directory and
# remove the # from the line below, then tune the settings in it, until you have reliable homing.
#[include sensorless-homing-tmc2209.cfg]

# If you want to only run sensorless homing on a single axis, copy the corresponding file from config/templates
# to the root directory and uncomment it below. Then tweak the settings in it until you have reliable homing.
#[include sensorless-x-homing-tmc2209.cfg]
#[include sensorless-y-homing-tmc2209.cfg]

#############################################################################################################
### INPUT SHAPER
### Enable/disable input shaper calibration
#############################################################################################################
# Uncomment this next line if you have an ADXL345 connected to your control board
#[include RatOS/printers/v-core-3/input-shaper.cfg]


#############################################################################################################
### TOOLHEAD
### Pick your extruder and hotend
#############################################################################################################
#[include RatOS/extruders/bmg.cfg]
#[include RatOS/extruders/lgx.cfg]
#[include RatOS/extruders/lgx-lite.cfg]
#[include RatOS/extruders/orbiter.cfg]
#[include RatOS/extruders/orbiter-2.cfg]
#[include RatOS/extruders/hemera.cfg]
#[include RatOS/extruders/titan.cfg]

# Hotend
#[include RatOS/hotends/v6.cfg]
#[include RatOS/hotends/revo.cfg]
#[include RatOS/hotends/dragonfly.cfg]
#[include RatOS/hotends/rapido.cfg]
#[include RatOS/hotends/copperhead.cfg]
#[include RatOS/hotends/mosquito.cfg]
#[include RatOS/hotends/mosquito-magnum.cfg]
#[include RatOS/hotends/dragon-standard-flow.cfg]
#[include RatOS/hotends/dragon-high-flow.cfg]


#############################################################################################################
### FANS
### If your board has 4 pin fan headers and you want to use them, you can enable them here.
### NOTE: If none are uncommented, the default 2pin fan headers will be used.
#############################################################################################################
# Part cooling
#[include RatOS/4pin-fans/part-cooling-fan-25khz.cfg]
#[include RatOS/4pin-fans/part-cooling-fan-100hz.cfg]

# Hotend / Toolhead cooling
#[include RatOS/4pin-fans/toolhead-fan-25khz.cfg]
#[include RatOS/4pin-fans/toolhead-fan-100hz.cfg]

# Control board cooling
#[include RatOS/4pin-fans/controller-fan-25khz.cfg]
#[include RatOS/4pin-fans/controller-fan-100hz.cfg]


#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: True
variable_preheat_extruder: True
variable_nozzle_priming: "none"
variable_start_print_park_in: "front"
variable_start_print_park_z_height: 50
variable_skew_profile: "true"
variable_end_print_park_in: "front"
variable_pause_print_park_in: "front"
variable_macro_travel_speed: 350
variable_nozzle_prime_start_x: 295
variable_adaptive_mesh: False
variable_calibrate_bed_mesh: True
variable_bed_mesh_profile: "default"

#############################################################################################################
### PRINTER CONFIGURATION
### Customize the defaults to your specific build
#############################################################################################################
[include mmu/base/*.cfg]

[stepper_x]
position_min: -11
position_max: 309
position_endstop: -11
homing_speed: 100

[stepper_y]
dir_pin: y_dir_pin # Add ! in front of pin name to reverse Y stepper direction
position_min: 0
position_max: 306
position_endstop: 306
rotation_distance: 40 # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 100

[stepper_z]
dir_pin: z0_dir_pin # Add ! in front of pin name to reverse Z stepper direction
rotation_distance: 4 # 4 for TR8*4 lead screws
position_max: 310

[stepper_z1]
dir_pin: z1_dir_pin # Add ! in front of pin name to reverse Z1 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[stepper_z2]
dir_pin: z2_dir_pin # Add ! in front of pin name to reverse Z2 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[printer]
max_z_velocity: 80

#[resonance_tester]
#probe_points:
#    150,150,20

#############################################################################################################
### TOOLBOARD
### If you have a toolboard installed, select it here
#############################################################################################################
#[include RatOS/boards/btt-ebb42-12/toolboard-config.cfg]

#[include RatOS/toolboard/input-shaper.cfg]

#############################################################################################################
### USER OVERRIDES
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
#############################################################################################################
[include timelapse.cfg]

[include custom/ratos_macros.cfg]

[include custom/fans/*]

[include custom/sensors/chamber_thermistor.cfg]

[include custom/awd/awd.cfg]

[include custom/probes/beacon.cfg]

[include custom/extruders/Vz-HextrudORT-Plus/config.cfg]
[include custom/hotends/goliath.cfg]

[include custom/autotune.cfg]

[z_tilt]
z_positions:
	-5, -2
	151,300
	306, -2
    
# Enable object exclusion
[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 16.481
#*# pid_ki = 0.923
#*# pid_kd = 73.546
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 70.772
#*# pid_ki = 2.496
#*# pid_kd = 501.596
#*#
#*# [probe]
#*# z_offset = 10.590
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 116.0
#*# shaper_type_y = mzv
#*# shaper_freq_y = 84.0
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	0.040729, 0.093125, 0.065208
#*# 	-0.021771, 0.025521, 0.003021
#*# 	0.012917, 0.002812, 0.019167
#*# 	-0.035729, 0.009792, -0.015521
#*# 	-0.045313, 0.020000, 0.031562
#*# min_x = 84.65
#*# max_x = 215.33
#*# min_y = 67.0
#*# max_y = 235.36
#*# x_count = 3
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*#
#*# [skew_correction pla_skew]
#*# xy_skew = 0.00544136003736162
#*# xz_skew = 0.0013690233785870565
#*# yz_skew = -0.004754598840646335
#*#
#*# [skew_correction asa_skew]
#*# xy_skew = 0.0007743165494060175
#*# xz_skew = -0.004692878667026418
#*# yz_skew = -0.0033394791934769903
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.099555, 0.067511, 0.043344, 0.028053, 0.016620, 0.006406, -0.002828, -0.012448, -0.037542, -0.046751, -0.060000, -0.065479, -0.065517, -0.067398, -0.064313, -0.076246, -0.078647, -0.071388, -0.053436, -0.026141, -0.000955, 0.029354, 0.039217, 0.057010, 0.073618
#*# 	  0.096490, 0.069717, 0.048813, 0.047097, 0.030374, 0.017046, -0.003014, -0.021094, -0.036129, -0.044410, -0.036665, -0.048310, -0.057321, -0.067317, -0.075550, -0.074610, -0.067610, -0.045175, -0.035806, -0.021450, 0.000307, 0.025236, 0.043957, 0.057036, 0.085915
#*# 	  0.100919, 0.072313, 0.053639, 0.035564, 0.024631, 0.013319, 0.006860, -0.015229, -0.028680, -0.038132, -0.051951, -0.054812, -0.055123, -0.056564, -0.060943, -0.062332, -0.061852, -0.060915, -0.042502, -0.018287, 0.007993, 0.031920, 0.048172, 0.061264, 0.077848
#*# 	  0.098144, 0.068992, 0.049138, 0.041718, 0.033347, 0.018213, 0.004248, -0.017282, -0.035403, -0.045947, -0.046115, -0.039390, -0.047397, -0.049668, -0.059537, -0.065764, -0.061366, -0.051902, -0.035505, -0.023937, 0.000963, 0.028042, 0.044395, 0.057966, 0.081320
#*# 	  0.103791, 0.076337, 0.061509, 0.047786, 0.033348, 0.017415, 0.003206, -0.014105, -0.030652, -0.039743, -0.042209, -0.042588, -0.049939, -0.053069, -0.059194, -0.065102, -0.060302, -0.050226, -0.037057, -0.024503, 0.000560, 0.027741, 0.048876, 0.066195, 0.085205
#*# 	  0.108138, 0.082611, 0.061439, 0.045874, 0.044893, 0.025521, 0.012468, -0.007733, -0.028298, -0.035264, -0.048185, -0.035946, -0.041622, -0.046457, -0.056040, -0.062848, -0.056349, -0.053486, -0.029279, -0.018938, 0.003610, 0.029583, 0.054356, 0.067518, 0.084478
#*# 	  0.113219, 0.089959, 0.071650, 0.060562, 0.048068, 0.027674, 0.010820, -0.004990, -0.015928, -0.023465, -0.030176, -0.034370, -0.043344, -0.051081, -0.059531, -0.055035, -0.047787, -0.039792, -0.026785, -0.016575, -0.000096, 0.030763, 0.057448, 0.077299, 0.096923
#*# 	  0.119346, 0.093024, 0.074245, 0.059392, 0.051313, 0.039578, 0.027776, 0.008115, -0.011491, -0.018615, -0.033348, -0.032564, -0.032676, -0.035499, -0.033106, -0.039773, -0.041740, -0.042191, -0.026489, -0.006898, 0.011370, 0.044182, 0.065657, 0.075810, 0.091837
#*# 	  0.125893, 0.102893, 0.087123, 0.080100, 0.058965, 0.041562, 0.025747, 0.008393, 0.001232, -0.003055, -0.009837, -0.020056, -0.030272, -0.037580, -0.041926, -0.039031, -0.026474, -0.018817, -0.013893, -0.003333, 0.012924, 0.043107, 0.067430, 0.090796, 0.108751
#*# 	  0.137248, 0.112389, 0.086357, 0.078545, 0.056319, 0.054470, 0.042882, 0.029625, 0.011949, -0.002908, -0.014532, -0.025239, -0.015868, -0.019841, -0.018083, -0.023336, -0.024554, -0.024612, -0.019287, 0.005172, 0.025123, 0.054333, 0.077008, 0.087401, 0.103457
#*# 	  0.142675, 0.120326, 0.101882, 0.087587, 0.075305, 0.058241, 0.041733, 0.029711, 0.019811, 0.013424, 0.007194, -0.001638, -0.014510, -0.024159, -0.021520, -0.018964, -0.004852, 0.002807, 0.006883, 0.013226, 0.026271, 0.055369, 0.082670, 0.101975, 0.116407
#*# 	  0.153841, 0.126467, 0.100948, 0.086032, 0.072263, 0.064577, 0.059405, 0.048054, 0.029648, 0.010481, 0.000466, -0.006095, -0.007498, -0.001998, -0.001637, 0.002180, -0.004127, -0.004908, -0.001820, 0.014239, 0.038918, 0.065550, 0.093229, 0.098576, 0.114435
#*# 	  0.149579, 0.127661, 0.109157, 0.097727, 0.081711, 0.066279, 0.053881, 0.041627, 0.033304, 0.025341, 0.014142, 0.005499, -0.002442, -0.011507, -0.009228, -0.001267, 0.010676, 0.013194, 0.016007, 0.017680, 0.032349, 0.060757, 0.087051, 0.110952, 0.128949
#*# 	  0.158578, 0.138402, 0.114128, 0.094555, 0.081343, 0.066608, 0.069611, 0.058294, 0.049766, 0.033524, 0.011781, 0.003619, 0.000832, 0.007890, 0.010698, 0.017003, 0.012864, 0.009586, 0.012842, 0.020785, 0.047759, 0.072198, 0.100177, 0.116125, 0.125879
#*# 	  0.160466, 0.138191, 0.119142, 0.105601, 0.092842, 0.077907, 0.065316, 0.053756, 0.045310, 0.038735, 0.027378, 0.019730, 0.004814, 0.003047, 0.004692, 0.012294, 0.022716, 0.027630, 0.033058, 0.036302, 0.050897, 0.077212, 0.103770, 0.128501, 0.143513
#*# 	  0.165861, 0.143665, 0.122446, 0.101970, 0.088625, 0.077177, 0.070473, 0.063810, 0.053085, 0.038629, 0.020276, 0.014207, 0.003821, 0.010249, 0.019566, 0.021886, 0.024483, 0.022814, 0.026680, 0.035890, 0.055962, 0.084660, 0.112041, 0.131593, 0.142928
#*# 	  0.165865, 0.141340, 0.122939, 0.110698, 0.097858, 0.083337, 0.072523, 0.062277, 0.051947, 0.045044, 0.031581, 0.024370, 0.012744, 0.012330, 0.016158, 0.023920, 0.032624, 0.034227, 0.040026, 0.046422, 0.059101, 0.085842, 0.113986, 0.136682, 0.152894
#*# 	  0.169420, 0.148009, 0.128886, 0.111515, 0.090968, 0.079965, 0.074897, 0.068659, 0.057419, 0.048500, 0.031563, 0.021008, 0.009838, 0.016288, 0.023652, 0.027761, 0.034884, 0.036019, 0.035094, 0.044461, 0.062227, 0.089617, 0.115456, 0.141343, 0.156785
#*# 	  0.173502, 0.148597, 0.131256, 0.117081, 0.102082, 0.089633, 0.079653, 0.066027, 0.056806, 0.048814, 0.035950, 0.026066, 0.018293, 0.015654, 0.019886, 0.025937, 0.034616, 0.038632, 0.044043, 0.051360, 0.063969, 0.089697, 0.116078, 0.140205, 0.159778
#*# 	  0.185656, 0.161545, 0.142469, 0.126226, 0.106051, 0.093721, 0.081810, 0.074616, 0.062675, 0.056467, 0.039634, 0.026975, 0.017482, 0.017954, 0.024183, 0.030126, 0.039799, 0.041685, 0.043895, 0.052015, 0.068516, 0.091413, 0.118894, 0.145347, 0.162722
#*# 	  0.190944, 0.166431, 0.148169, 0.134014, 0.118633, 0.104202, 0.092442, 0.076927, 0.065918, 0.057936, 0.046209, 0.038692, 0.028999, 0.026854, 0.028475, 0.031597, 0.039184, 0.045244, 0.051608, 0.061450, 0.075222, 0.096652, 0.123521, 0.149418, 0.168966
#*# 	  0.201709, 0.180158, 0.160358, 0.145416, 0.121570, 0.109755, 0.093909, 0.086084, 0.075617, 0.065645, 0.054542, 0.046024, 0.031485, 0.032246, 0.035820, 0.042512, 0.048039, 0.051869, 0.057105, 0.063121, 0.077612, 0.100225, 0.127831, 0.154512, 0.173721
#*# 	  0.208742, 0.184714, 0.162369, 0.149873, 0.132054, 0.117480, 0.103763, 0.090817, 0.078571, 0.069635, 0.058827, 0.052384, 0.043649, 0.041970, 0.045421, 0.046948, 0.052734, 0.057144, 0.065141, 0.074797, 0.086943, 0.108589, 0.134001, 0.161379, 0.180915
#*# 	  0.217841, 0.198319, 0.179259, 0.160473, 0.139978, 0.122702, 0.109333, 0.095973, 0.086538, 0.078324, 0.069500, 0.059141, 0.049057, 0.048539, 0.051824, 0.058485, 0.063681, 0.067640, 0.072910, 0.081742, 0.096123, 0.115697, 0.139222, 0.171049, 0.189564
#*# 	  0.225781, 0.201498, 0.183588, 0.167379, 0.147111, 0.131257, 0.117332, 0.103147, 0.089968, 0.084569, 0.076399, 0.070181, 0.059311, 0.058770, 0.061384, 0.066763, 0.072000, 0.076017, 0.083689, 0.090589, 0.102600, 0.122792, 0.146980, 0.172687, 0.181961
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 275.0
#*# min_y = 35.0
#*# max_y = 260.0
#*#
#*# [beacon model default]
#*# model_coef = 1.509133581225658,
#*# 	  1.8645643123981832,
#*# 	  0.766831363594402,
#*# 	  0.28442804371462466,
#*# 	  0.4142641858278088,
#*# 	  0.5567964931209547,
#*# 	  -0.30404035475720403,
#*# 	  -0.632147729784487,
#*# 	  0.21413136685178502,
#*# 	  0.32860018193425533
#*# model_domain = 1.8431411900272424e-07,1.9284806302319655e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 67.547555
#*# model_offset = -0.15000
#*#
#*# [beacon model hot]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [beacon model fulaflex-3_hot]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [beacon model fulaflex-3_hot_detailed]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
