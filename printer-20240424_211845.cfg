# Rat Rig V-core 3 Klipper Config
# Documentation: https://os.ratrig.com

# The first thing you'll need to do is go through this file and comment out / uncomment
# the files and/or settings you need.
# You'll be able to print just fine with this config as it is, but it is recommended
# that you follow these steps to properly calibrate your printer:
# 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
# 1) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
# 2) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
# 3) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html

# Read more about klipper here: https://www.klipper3d.org/Overview.html

#############################################################################################################
### CONTROL BOARD
### Pick the board you have installed and wired in your printer.
#############################################################################################################
[include custom/boards/octopus_max_ez/config.cfg]

#############################################################################################################
### BASE SETUP
#############################################################################################################
[include custom/printers/v-core-3/v-core-3.cfg]
[include RatOS/homing.cfg]
[include RatOS/macros.cfg]
[include RatOS/shell-macros.cfg]
[include RatOS/printers/v-core-3/macros.cfg]


#############################################################################################################
### STEPPER MOTORS, DRIVERS & SPEED LIMITS
### Pick the drivers and stepper motors you're using. See the RatOS documentation for custom combinations.
#############################################################################################################
[include RatOS/printers/v-core-3/steppers.cfg]

# UNCOOLED TMC 2209 + LDO-42STH48-2504AC
#[include RatOS/printers/v-core-3/tmc2209.cfg]
#[include RatOS/printers/v-core-3/speed-limits-basic.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-x.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-y.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z1.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z2.cfg]

# COOLED TMC 2209 + LDO-42STH48-2504AC
# This increases motor torque, positional accuracy and speed limits.
# don't enable this before your printer is fully configured and you have a fan blowing on your stepper drivers.
#[include RatOS/printers/v-core-3/speed-limits-performance.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-x.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-y.cfg]

[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z1.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z2.cfg]

# STEALTH MODE (Enables stealthchop and limits velocity and acceleration)
# NOTE: You still need to include one of the above stepper motor definitions.
# NOTE: This will make your printer quiter but less accurate, it's an inherent side effect of stealthchop.
#[include RatOS/printers/v-core-3/speed-limits-stealth.cfg]
#[include RatOS/printers/v-core-3/tmc2209-stealth.cfg]

#############################################################################################################
### PHYSICAL DIMENSIONS
### Pick your printer size
#############################################################################################################
# Remove the # from your printer size below.
# Similarly add a # in front of [include RatOS/printers/v-core-3/300.cfg] if you have a bigger machine.
#[include RatOS/printers/v-core-3/200.cfg]
[include RatOS/printers/v-core-3/300.cfg]
#[include RatOS/printers/v-core-3/400.cfg]
#[include RatOS/printers/v-core-3/500.cfg]

#############################################################################################################
### HOMING
### Pick your probe and endstops
#############################################################################################################
# BL Touch
#[include RatOS/z-probe/bltouch.cfg]

# Inductive/Capacitive probe
#[include RatOS/z-probe/probe.cfg]

# Beacon probe
#[include RatOS/z-probe/beacon.cfg]

# Euclid probe (please read the RatOS documentation for instructions)
# [include RatOS/z-probe/euclid.cfg]

# Klicky probe (please read the RatOS documentation for instructions)
#[include RatOS/z-probe/klicky/klicky.cfg]
#[include RatOS/z-probe/klicky/unklicky.cfg]

# Physical endstop on X
# [include RatOS/printers/v-core-3/physical-endstop-x.cfg]
# Physical endstop on Y
# [include RatOS/printers/v-core-3/physical-endstop-y.cfg]

# Sensorless homing (Beware: this requires manual tinkering and does not work if your x/y stepper drivers
# have clipped DIAG pins). It is strongly encouraged to use physical endstops if you're a beginner.
# If you still wish to proceed, copy config/templates/sensorless-homing-tmc2209.cfg to the root directory and
# remove the # from the line below, then tune the settings in it, until you have reliable homing.
#[include sensorless-homing-tmc2209.cfg]

# If you want to only run sensorless homing on a single axis, copy the corresponding file from config/templates
# to the root directory and uncomment it below. Then tweak the settings in it until you have reliable homing.
#[include sensorless-x-homing-tmc2209.cfg]
#[include sensorless-y-homing-tmc2209.cfg]

#############################################################################################################
### INPUT SHAPER
### Enable/disable input shaper calibration
#############################################################################################################
# Uncomment this next line if you have an ADXL345 connected to your control board
#[include RatOS/printers/v-core-3/input-shaper.cfg]


#############################################################################################################
### TOOLHEAD
### Pick your extruder and hotend
#############################################################################################################
#[include RatOS/extruders/bmg.cfg]
#[include RatOS/extruders/lgx.cfg]
#[include RatOS/extruders/lgx-lite.cfg]
#[include RatOS/extruders/orbiter.cfg]
#[include RatOS/extruders/orbiter-2.cfg]
#[include RatOS/extruders/hemera.cfg]
#[include RatOS/extruders/titan.cfg]

# Hotend
#[include RatOS/hotends/v6.cfg]
#[include RatOS/hotends/revo.cfg]
#[include RatOS/hotends/dragonfly.cfg]
#[include RatOS/hotends/rapido.cfg]
#[include RatOS/hotends/copperhead.cfg]
#[include RatOS/hotends/mosquito.cfg]
#[include RatOS/hotends/mosquito-magnum.cfg]
#[include RatOS/hotends/dragon-standard-flow.cfg]
#[include RatOS/hotends/dragon-high-flow.cfg]


#############################################################################################################
### FANS
### If your board has 4 pin fan headers and you want to use them, you can enable them here.
### NOTE: If none are uncommented, the default 2pin fan headers will be used.
#############################################################################################################
# Part cooling
#[include RatOS/4pin-fans/part-cooling-fan-25khz.cfg]
#[include RatOS/4pin-fans/part-cooling-fan-100hz.cfg]

# Hotend / Toolhead cooling
#[include RatOS/4pin-fans/toolhead-fan-25khz.cfg]
#[include RatOS/4pin-fans/toolhead-fan-100hz.cfg]

# Control board cooling
#[include RatOS/4pin-fans/controller-fan-25khz.cfg]
#[include RatOS/4pin-fans/controller-fan-100hz.cfg]


#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: True
variable_preheat_extruder: True
variable_nozzle_priming: "none"
variable_start_print_park_in: "front"
variable_start_print_park_z_height: 50
variable_safe_home_x: 275
variable_safe_home_y: 260
variable_skew_profile: "true"
variable_end_print_park_in: "front"
variable_pause_print_park_in: "front"
variable_macro_travel_speed: 350
variable_nozzle_prime_start_x: 295
variable_adaptive_mesh: False
variable_calibrate_bed_mesh: True
variable_bed_mesh_profile: "default"

#############################################################################################################
### PRINTER CONFIGURATION
### Customize the defaults to your specific build
#############################################################################################################
[include mmu/base/*.cfg]

[stepper_x]
position_min: -11
position_max: 306
position_endstop: -11
homing_speed: 100

[stepper_y]
dir_pin: y_dir_pin # Add ! in front of pin name to reverse Y stepper direction
position_min: 0
position_max: 306
position_endstop: 306
rotation_distance: 40 # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 100

[stepper_z]
dir_pin: z0_dir_pin # Add ! in front of pin name to reverse Z stepper direction
rotation_distance: 4 # 4 for TR8*4 lead screws
position_max: 310

[stepper_z1]
dir_pin: z1_dir_pin # Add ! in front of pin name to reverse Z1 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[stepper_z2]
dir_pin: z2_dir_pin # Add ! in front of pin name to reverse Z2 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[printer]
max_z_velocity: 80

#[resonance_tester]
#probe_points:
#    150,150,20

#############################################################################################################
### TOOLBOARD
### If you have a toolboard installed, select it here
#############################################################################################################
#[include RatOS/boards/btt-ebb42-12/toolboard-config.cfg]

#[include RatOS/toolboard/input-shaper.cfg]

#############################################################################################################
### USER OVERRIDES
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
#############################################################################################################
[include timelapse.cfg]

[include custom/ratos_macros.cfg]

[include custom/fans/*]

[include custom/sensors/chamber_thermistors.cfg]

[include custom/awd/awd.cfg]

[include custom/probes/beacon.cfg]

[include custom/extruders/Vz-HextrudORT-Plus/config.cfg]
[include custom/hotends/goliath.cfg]

[include custom/autotune.cfg]

[z_tilt]
z_positions:
	-5, -2
	151,300
	306, -2
    
# Enable object exclusion
[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 16.481
#*# pid_ki = 0.923
#*# pid_kd = 73.546
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 70.772
#*# pid_ki = 2.496
#*# pid_kd = 501.596
#*#
#*# [probe]
#*# z_offset = 10.590
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 96.0
#*# shaper_type_y = mzv
#*# shaper_freq_y = 77.4
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	0.040729, 0.093125, 0.065208
#*# 	-0.021771, 0.025521, 0.003021
#*# 	0.012917, 0.002812, 0.019167
#*# 	-0.035729, 0.009792, -0.015521
#*# 	-0.045313, 0.020000, 0.031562
#*# min_x = 84.65
#*# max_x = 215.33
#*# min_y = 67.0
#*# max_y = 235.36
#*# x_count = 3
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*#
#*# [skew_correction pla_skew]
#*# xy_skew = 0.00544136003736162
#*# xz_skew = 0.0013690233785870565
#*# yz_skew = -0.004754598840646335
#*#
#*# [skew_correction asa_skew]
#*# xy_skew = 0.0007743165494060175
#*# xz_skew = -0.004692878667026418
#*# yz_skew = -0.0033394791934769903
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.098507, 0.093555, 0.089997, 0.086639, 0.087329, 0.092242, 0.095648, 0.099786, 0.102388, 0.106305, 0.104176, 0.097282, 0.095932, 0.092766, 0.092254, 0.090544, 0.089511, 0.086992, 0.084631, 0.087258, 0.094553, 0.100114, 0.102949, 0.094492, 0.081375
#*# 	  0.097802, 0.092486, 0.095182, 0.095434, 0.092774, 0.097979, 0.092188, 0.104826, 0.111338, 0.097545, 0.100720, 0.112448, 0.090049, 0.093786, 0.105872, 0.092219, 0.094515, 0.099129, 0.086128, 0.090116, 0.097813, 0.103686, 0.108213, 0.097946, 0.083231
#*# 	  0.096911, 0.093521, 0.091077, 0.086057, 0.098546, 0.094422, 0.098299, 0.099197, 0.103035, 0.110221, 0.104593, 0.099395, 0.097702, 0.088672, 0.088620, 0.091394, 0.092096, 0.093512, 0.081479, 0.078485, 0.090165, 0.095680, 0.098986, 0.090410, 0.074039
#*# 	  0.096835, 0.087164, 0.089731, 0.075337, 0.085786, 0.085252, 0.079663, 0.091708, 0.094389, 0.088895, 0.099445, 0.095824, 0.080700, 0.083836, 0.093265, 0.071737, 0.080937, 0.087251, 0.064535, 0.064723, 0.073116, 0.089586, 0.099631, 0.083702, 0.068608
#*# 	  0.087833, 0.086158, 0.083413, 0.074731, 0.080448, 0.076773, 0.081264, 0.083624, 0.086812, 0.091593, 0.090540, 0.095930, 0.082790, 0.076909, 0.084304, 0.074330, 0.073661, 0.079308, 0.066533, 0.066729, 0.075229, 0.090338, 0.095272, 0.084467, 0.063731
#*# 	  0.094655, 0.087586, 0.089620, 0.064672, 0.079383, 0.072343, 0.078341, 0.080657, 0.083474, 0.086538, 0.085159, 0.082631, 0.078962, 0.074050, 0.075211, 0.064453, 0.073981, 0.070810, 0.057077, 0.066197, 0.073215, 0.098487, 0.101727, 0.085148, 0.063782
#*# 	  0.094166, 0.092439, 0.080945, 0.071997, 0.066398, 0.069981, 0.076143, 0.081610, 0.089798, 0.084326, 0.074108, 0.085727, 0.074388, 0.064128, 0.080149, 0.071748, 0.064516, 0.069723, 0.063681, 0.063436, 0.074849, 0.090487, 0.094571, 0.081397, 0.065118
#*# 	  0.091843, 0.083776, 0.072855, 0.065874, 0.077120, 0.070110, 0.087151, 0.082501, 0.083025, 0.083907, 0.082027, 0.078194, 0.073711, 0.070224, 0.072436, 0.071342, 0.071741, 0.068627, 0.063239, 0.062908, 0.067746, 0.095269, 0.099426, 0.083550, 0.065101
#*# 	  0.094216, 0.084696, 0.083407, 0.076179, 0.069771, 0.071292, 0.078072, 0.076035, 0.090672, 0.085416, 0.077332, 0.079917, 0.075359, 0.066381, 0.074055, 0.072598, 0.072241, 0.068385, 0.064245, 0.064152, 0.070238, 0.090237, 0.092654, 0.084382, 0.065990
#*# 	  0.092679, 0.086435, 0.073706, 0.067541, 0.084018, 0.086486, 0.090911, 0.074837, 0.086256, 0.098711, 0.087962, 0.086104, 0.092198, 0.076597, 0.078550, 0.087709, 0.076814, 0.072562, 0.066028, 0.064360, 0.072955, 0.091567, 0.084348, 0.082366, 0.065582
#*# 	  0.096092, 0.086276, 0.086320, 0.082037, 0.084626, 0.095469, 0.092973, 0.086453, 0.095287, 0.096554, 0.094141, 0.091952, 0.086272, 0.083155, 0.083942, 0.084326, 0.085316, 0.081513, 0.074548, 0.068685, 0.065485, 0.085984, 0.089395, 0.087476, 0.071834
#*# 	  0.094852, 0.087726, 0.078703, 0.085149, 0.093832, 0.088393, 0.093963, 0.085805, 0.098682, 0.100636, 0.085263, 0.094069, 0.099650, 0.077250, 0.086649, 0.092845, 0.076759, 0.081301, 0.083434, 0.070689, 0.071103, 0.071678, 0.082301, 0.085721, 0.072322
#*# 	  0.101598, 0.089948, 0.088168, 0.086835, 0.088802, 0.091566, 0.094565, 0.099657, 0.098059, 0.102054, 0.097583, 0.091233, 0.089089, 0.083905, 0.080774, 0.081378, 0.088897, 0.080283, 0.073177, 0.066410, 0.060551, 0.076467, 0.084565, 0.082126, 0.068832
#*# 	  0.099018, 0.094070, 0.092293, 0.091865, 0.095353, 0.099340, 0.101791, 0.106342, 0.103368, 0.107871, 0.090676, 0.095990, 0.092227, 0.079632, 0.089815, 0.090802, 0.082718, 0.086927, 0.087373, 0.071602, 0.073912, 0.073153, 0.084749, 0.081438, 0.074129
#*# 	  0.100995, 0.096689, 0.098992, 0.092067, 0.096909, 0.100984, 0.104547, 0.104771, 0.104361, 0.103919, 0.103979, 0.094182, 0.091314, 0.094080, 0.088899, 0.082103, 0.095058, 0.087467, 0.078407, 0.076415, 0.074283, 0.081545, 0.093529, 0.090820, 0.079610
#*# 	  0.097686, 0.095340, 0.095268, 0.094520, 0.096730, 0.091949, 0.100585, 0.098950, 0.098163, 0.098370, 0.094040, 0.089211, 0.087748, 0.083906, 0.086178, 0.086332, 0.088122, 0.088030, 0.081945, 0.076271, 0.077315, 0.076581, 0.091139, 0.089121, 0.075669
#*# 	  0.099091, 0.092887, 0.094514, 0.091159, 0.088091, 0.089845, 0.094645, 0.098504, 0.094732, 0.090964, 0.093626, 0.087891, 0.079759, 0.079612, 0.080606, 0.079872, 0.085873, 0.084248, 0.078966, 0.073772, 0.070268, 0.073604, 0.086494, 0.085324, 0.074405
#*# 	  0.088276, 0.084130, 0.082915, 0.082597, 0.084438, 0.086180, 0.089100, 0.096709, 0.089657, 0.088640, 0.093317, 0.082569, 0.077040, 0.072438, 0.074229, 0.077948, 0.080572, 0.079356, 0.074403, 0.069288, 0.067535, 0.066554, 0.078340, 0.078718, 0.066415
#*# 	  0.091211, 0.084337, 0.085419, 0.084059, 0.079443, 0.082294, 0.083559, 0.086265, 0.086554, 0.083501, 0.082780, 0.079605, 0.073465, 0.071164, 0.071073, 0.073532, 0.077061, 0.078472, 0.074070, 0.066732, 0.061554, 0.064195, 0.075645, 0.077472, 0.067111
#*# 	  0.096670, 0.086833, 0.083561, 0.084223, 0.083611, 0.087788, 0.087789, 0.090279, 0.082959, 0.087259, 0.085947, 0.079581, 0.074718, 0.073765, 0.070611, 0.071883, 0.075568, 0.076796, 0.073995, 0.067472, 0.064413, 0.063411, 0.074092, 0.076518, 0.067246
#*# 	  0.103902, 0.094247, 0.091460, 0.088432, 0.085831, 0.088743, 0.089508, 0.086790, 0.085287, 0.084706, 0.082454, 0.079876, 0.075393, 0.071172, 0.072599, 0.071662, 0.074313, 0.072832, 0.067805, 0.066139, 0.060178, 0.060908, 0.070325, 0.074663, 0.065422
#*# 	  0.111307, 0.098731, 0.093744, 0.090914, 0.089425, 0.092385, 0.092261, 0.090350, 0.086012, 0.085496, 0.082445, 0.081398, 0.078892, 0.075117, 0.074618, 0.075697, 0.074962, 0.074102, 0.069949, 0.065503, 0.061881, 0.061812, 0.070582, 0.075662, 0.068372
#*# 	  0.113371, 0.102414, 0.097052, 0.090891, 0.090786, 0.092894, 0.092806, 0.091286, 0.090075, 0.088363, 0.081967, 0.081724, 0.078492, 0.077079, 0.076409, 0.075388, 0.076826, 0.075657, 0.067808, 0.063010, 0.058001, 0.060093, 0.069262, 0.074134, 0.067874
#*# 	  0.118268, 0.108969, 0.102634, 0.096868, 0.092334, 0.097435, 0.096664, 0.094962, 0.093369, 0.093628, 0.088659, 0.086354, 0.083775, 0.082672, 0.082515, 0.083180, 0.083480, 0.081305, 0.075246, 0.070770, 0.065210, 0.063071, 0.071672, 0.078729, 0.073916
#*# 	  0.121076, 0.111811, 0.105462, 0.099128, 0.096832, 0.096157, 0.096319, 0.093373, 0.093385, 0.092883, 0.092072, 0.086472, 0.084756, 0.083818, 0.083534, 0.084502, 0.085474, 0.084452, 0.079531, 0.072920, 0.064909, 0.063001, 0.071286, 0.077953, 0.073430
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 275.0
#*# min_y = 35.0
#*# max_y = 260.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4877201704125254,
#*# 	  1.8819458901002257,
#*# 	  0.8798747198387306,
#*# 	  0.27770115881531493,
#*# 	  0.07519433321414798,
#*# 	  0.32261929240138393,
#*# 	  0.06687019582553386,
#*# 	  -0.23787601218798288,
#*# 	  0.09102071064843396,
#*# 	  0.1576335200242086
#*# model_domain = 1.820740573214127e-07,1.9250154827053466e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 23.096660
#*# model_offset = 0.18000
#*#
#*# [beacon model hot]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [beacon model fulaflex-3_hot]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [beacon model fulaflex-3_hot_detailed]
#*# model_coef = 1.4777751791060854,
#*# 	1.791743650258654,
#*# 	0.753103134001745,
#*# 	0.376672133301129,
#*# 	0.2873804476528069,
#*# 	0.1942836001887098,
#*# 	-0.07751244935002463,
#*# 	-0.06007115429964557,
#*# 	0.16004943209168543,
#*# 	0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
