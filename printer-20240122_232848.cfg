# Rat Rig V-core 3 Klipper Config
# Documentation: https://os.ratrig.com

# The first thing you'll need to do is go through this file and comment out / uncomment
# the files and/or settings you need.
# You'll be able to print just fine with this config as it is, but it is recommended
# that you follow these steps to properly calibrate your printer:
# 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
# 1) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
# 2) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
# 3) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html

# Read more about klipper here: https://www.klipper3d.org/Overview.html

#############################################################################################################
### CONTROL BOARD
### Pick the board you have installed and wired in your printer.
#############################################################################################################
[include custom/boards/octopus_max_ez/config.cfg]

#############################################################################################################
### BASE SETUP
#############################################################################################################
[include custom/printers/v-core-3/v-core-3.cfg]
[include RatOS/homing.cfg]
[include RatOS/macros.cfg]
[include RatOS/shell-macros.cfg]
[include RatOS/printers/v-core-3/macros.cfg]


#############################################################################################################
### STEPPER MOTORS, DRIVERS & SPEED LIMITS
### Pick the drivers and stepper motors you're using. See the RatOS documentation for custom combinations.
#############################################################################################################
[include RatOS/printers/v-core-3/steppers.cfg]

# UNCOOLED TMC 2209 + LDO-42STH48-2504AC
#[include RatOS/printers/v-core-3/tmc2209.cfg]
#[include RatOS/printers/v-core-3/speed-limits-basic.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-x.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-y.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z1.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z2.cfg]

# COOLED TMC 2209 + LDO-42STH48-2504AC
# This increases motor torque, positional accuracy and speed limits.
# don't enable this before your printer is fully configured and you have a fan blowing on your stepper drivers.
#[include RatOS/printers/v-core-3/speed-limits-performance.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-x.cfg]
#[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-y.cfg]

[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z1.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.6a-z2.cfg]

# STEALTH MODE (Enables stealthchop and limits velocity and acceleration)
# NOTE: You still need to include one of the above stepper motor definitions.
# NOTE: This will make your printer quiter but less accurate, it's an inherent side effect of stealthchop.
#[include RatOS/printers/v-core-3/speed-limits-stealth.cfg]
#[include RatOS/printers/v-core-3/tmc2209-stealth.cfg]

#############################################################################################################
### PHYSICAL DIMENSIONS
### Pick your printer size
#############################################################################################################
# Remove the # from your printer size below.
# Similarly add a # in front of [include RatOS/printers/v-core-3/300.cfg] if you have a bigger machine.
#[include RatOS/printers/v-core-3/200.cfg]
[include RatOS/printers/v-core-3/300.cfg]
#[include RatOS/printers/v-core-3/400.cfg]
#[include RatOS/printers/v-core-3/500.cfg]

#############################################################################################################
### HOMING
### Pick your probe and endstops
#############################################################################################################
# BL Touch
#[include RatOS/z-probe/bltouch.cfg]

# Inductive/Capacitive probe
#[include RatOS/z-probe/probe.cfg]

# Beacon probe
# [include RatOS/z-probe/beacon.cfg]

# Euclid probe (please read the RatOS documentation for instructions)
# [include RatOS/z-probe/euclid.cfg]

# Klicky probe (please read the RatOS documentation for instructions)
#[include RatOS/z-probe/klicky/klicky.cfg]
#[include RatOS/z-probe/klicky/unklicky.cfg]

# Physical endstop on X
# [include RatOS/printers/v-core-3/physical-endstop-x.cfg]
# Physical endstop on Y
# [include RatOS/printers/v-core-3/physical-endstop-y.cfg]

# Sensorless homing (Beware: this requires manual tinkering and does not work if your x/y stepper drivers
# have clipped DIAG pins). It is strongly encouraged to use physical endstops if you're a beginner.
# If you still wish to proceed, copy config/templates/sensorless-homing-tmc2209.cfg to the root directory and
# remove the # from the line below, then tune the settings in it, until you have reliable homing.
#[include sensorless-homing-tmc2209.cfg]

# If you want to only run sensorless homing on a single axis, copy the corresponding file from config/templates
# to the root directory and uncomment it below. Then tweak the settings in it until you have reliable homing.
#[include sensorless-x-homing-tmc2209.cfg]
#[include sensorless-y-homing-tmc2209.cfg]

#############################################################################################################
### INPUT SHAPER
### Enable/disable input shaper calibration
#############################################################################################################
# Uncomment this next line if you have an ADXL345 connected to your control board
# [include RatOS/printers/v-core-3/input-shaper.cfg]


#############################################################################################################
### TOOLHEAD
### Pick your extruder and hotend
#############################################################################################################
#[include RatOS/extruders/bmg.cfg]
#[include RatOS/extruders/lgx.cfg]
#[include RatOS/extruders/lgx-lite.cfg]
#[include RatOS/extruders/orbiter.cfg]
#[include RatOS/extruders/orbiter-2.cfg]
#[include RatOS/extruders/hemera.cfg]
#[include RatOS/extruders/titan.cfg]

# Hotend
#[include RatOS/hotends/v6.cfg]
#[include RatOS/hotends/revo.cfg]
#[include RatOS/hotends/dragonfly.cfg]
#[include RatOS/hotends/rapido.cfg]
#[include RatOS/hotends/copperhead.cfg]
#[include RatOS/hotends/mosquito.cfg]
#[include RatOS/hotends/mosquito-magnum.cfg]
#[include RatOS/hotends/dragon-standard-flow.cfg]
#[include RatOS/hotends/dragon-high-flow.cfg]


#############################################################################################################
### FANS
### If your board has 4 pin fan headers and you want to use them, you can enable them here.
### NOTE: If none are uncommented, the default 2pin fan headers will be used.
#############################################################################################################
# Part cooling
#[include RatOS/4pin-fans/part-cooling-fan-25khz.cfg]
#[include RatOS/4pin-fans/part-cooling-fan-100hz.cfg]

# Hotend / Toolhead cooling
#[include RatOS/4pin-fans/toolhead-fan-25khz.cfg]
#[include RatOS/4pin-fans/toolhead-fan-100hz.cfg]

# Control board cooling
#[include RatOS/4pin-fans/controller-fan-25khz.cfg]
#[include RatOS/4pin-fans/controller-fan-100hz.cfg]


#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: True
variable_preheat_extruder: True
variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "front"
variable_start_print_park_z_height: 50
variable_skew_profile: "true"
variable_end_print_park_in: "front"
variable_pause_print_park_in: "front"
variable_macro_travel_speed: 350
variable_nozzle_prime_start_x: 295
variable_adaptive_mesh: False
variable_calibrate_bed_mesh: False
variable_bed_mesh_profile: "default"

#############################################################################################################
### PRINTER CONFIGURATION
### Customize the defaults to your specific build
#############################################################################################################
#[include mmu/base/*.cfg]
#[include mmu/optional/mmu_menu.cfg]

[stepper_x]
position_min: -11
position_max: 309
position_endstop: -11
homing_speed: 100

[stepper_y]
dir_pin: y_dir_pin # Add ! in front of pin name to reverse Y stepper direction
position_min: 0
position_max: 306
position_endstop: 306
rotation_distance: 40 # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 100

[stepper_z]
dir_pin: z0_dir_pin # Add ! in front of pin name to reverse Z stepper direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[stepper_z1]
dir_pin: z1_dir_pin # Add ! in front of pin name to reverse Z1 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[stepper_z2]
dir_pin: z2_dir_pin # Add ! in front of pin name to reverse Z2 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[printer]
max_z_velocity: 80

#[resonance_tester]
#probe_points:
#    150,150,20

#############################################################################################################
### TOOLBOARD
### If you have a toolboard installed, select it here
#############################################################################################################
#[include RatOS/boards/btt-ebb42-12/toolboard-config.cfg]

#[include RatOS/toolboard/input-shaper.cfg]

#############################################################################################################
### USER OVERRIDES
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
#############################################################################################################
[include timelapse.cfg]

[include custom/client_macros.cfg]

[include custom/fans/*]

[include custom/sensors/chamber_thermistor.cfg]

[include custom/awd/awd.cfg]

[include custom/probes/beacon.cfg]

#[include custom/sensors/pis.cfg]

[include custom/extruders/Vz-HextrudORT.cfg]
[include custom/hotends/goliath.cfg]

[z_tilt]
z_positions:
	-5, -2
	151,300
	306, -2
    
# Enable object exclusion
[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.851
#*# pid_ki = 1.133
#*# pid_kd = 70.289
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 69.499
#*# pid_ki = 1.899
#*# pid_kd = 635.916
#*#
#*# [probe]
#*# z_offset = 10.590
#*#
#*# [input_shaper]
#*# shaper_type_x = 2hump_ei
#*# shaper_freq_x = 131.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 73.8
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	0.040729, 0.093125, 0.065208
#*# 	-0.021771, 0.025521, 0.003021
#*# 	0.012917, 0.002812, 0.019167
#*# 	-0.035729, 0.009792, -0.015521
#*# 	-0.045313, 0.020000, 0.031562
#*# min_x = 84.65
#*# max_x = 215.33
#*# min_y = 67.0
#*# max_y = 235.36
#*# x_count = 3
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*#
#*# [skew_correction pla_skew]
#*# xy_skew = 0.00544136003736162
#*# xz_skew = 0.0013690233785870565
#*# yz_skew = -0.004754598840646335
#*#
#*# [skew_correction asa_skew]
#*# xy_skew = 0.0007743165494060175
#*# xz_skew = -0.004692878667026418
#*# yz_skew = -0.0033394791934769903
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.000221, -0.012936, -0.018166, -0.019489, -0.013843, -0.006848, -0.001098, 0.000210, 0.006683, -0.001523, -0.007410, -0.010744, -0.012290, -0.014152, -0.017477, -0.018519, -0.020970, -0.025325, -0.030260, -0.025147, -0.014664, -0.004478, 0.000995, 0.000860, -0.007746
#*# 	0.003231, -0.011415, -0.016297, -0.015286, -0.010404, -0.005137, -0.000585, 0.003805, 0.013252, 0.004704, -0.001140, -0.006203, -0.007946, -0.009795, -0.010661, -0.012055, -0.016324, -0.021523, -0.025673, -0.023499, -0.013878, -0.003477, -0.000217, -0.002939, -0.013162
#*# 	0.001339, -0.010811, -0.014477, -0.008502, -0.004091, -0.002248, -0.006451, -0.002637, 0.003441, -0.002400, -0.003471, -0.005305, -0.009322, -0.011679, -0.010601, -0.010656, -0.014457, -0.020215, -0.021963, -0.020924, -0.013931, -0.004868, -0.001076, -0.004700, -0.012106
#*# 	0.005317, -0.006684, -0.008220, -0.002546, 0.000686, 0.006059, 0.005968, 0.008511, 0.011460, 0.010087, 0.008819, 0.006976, 0.001925, -0.000519, 0.000282, 0.001205, -0.002471, -0.008985, -0.013639, -0.011330, -0.007457, 0.000648, 0.004577, 0.004529, -0.003784
#*# 	0.007067, 0.000448, -0.002285, -0.000657, 0.008475, 0.018308, 0.015898, 0.019897, 0.024259, 0.026199, 0.023537, 0.019159, 0.015554, 0.008990, 0.010983, 0.017932, 0.021849, 0.016729, -0.002922, -0.004232, 0.000073, 0.006503, 0.010970, 0.011304, 0.003362
#*# 	-0.006465, -0.011477, -0.015863, -0.014953, -0.003051, 0.006076, 0.017722, 0.022742, 0.018849, 0.020711, 0.022592, 0.010855, 0.004039, 0.000481, 0.005876, 0.007553, 0.008209, 0.009172, -0.001597, -0.017886, -0.015501, -0.007854, -0.002783, -0.001607, -0.008517
#*# 	-0.006586, -0.011890, -0.014258, -0.010020, 0.007284, 0.019715, 0.032380, 0.039423, 0.028728, 0.023946, 0.018577, 0.017605, 0.003208, 0.001663, 0.010292, 0.011668, 0.009761, 0.005965, 0.008524, -0.008177, -0.013439, -0.004587, 0.002614, -0.001014, -0.007522
#*# 	0.005875, 0.002879, 0.002468, 0.010173, 0.026745, 0.036887, 0.044697, 0.045644, 0.043618, 0.039792, 0.037897, 0.032454, 0.024051, 0.019948, 0.021369, 0.026452, 0.020320, 0.017646, 0.017337, 0.015112, 0.006715, 0.010641, 0.013429, 0.015307, 0.003470
#*# 	0.001983, 0.000964, 0.001395, 0.012693, 0.028438, 0.039524, 0.039717, 0.033887, 0.038306, 0.037987, 0.034084, 0.030250, 0.019619, 0.015293, 0.017583, 0.020092, 0.017170, 0.013844, 0.010676, 0.003840, 0.007574, 0.011325, 0.013267, 0.010849, -0.000292
#*# 	0.001312, 0.002799, 0.002711, 0.006281, 0.017861, 0.021053, 0.028848, 0.034234, 0.035597, 0.031670, 0.025365, 0.023136, 0.014870, 0.007562, 0.004346, 0.002074, 0.007739, 0.005041, 0.004827, 0.004760, 0.003337, 0.007784, 0.004153, -0.001426, -0.009104
#*# 	-0.010188, -0.002931, -0.002053, 0.007345, 0.015573, 0.022889, 0.027732, 0.028513, 0.032704, 0.032500, 0.021894, 0.010682, 0.002143, 0.002803, 0.005974, 0.008292, 0.006826, 0.002676, 0.003672, 0.003509, 0.003038, 0.002888, -0.001198, -0.008463, -0.024463
#*# 	-0.007301, -0.007231, -0.001053, 0.008460, 0.017409, 0.024249, 0.026813, 0.025880, 0.026255, 0.024812, 0.015452, 0.006647, 0.005834, 0.001126, 0.004905, 0.007671, 0.006546, 0.007789, 0.003344, 0.001421, -0.000800, 0.002179, -0.002462, -0.014595, -0.020628
#*# 	-0.003127, 0.002216, 0.005558, 0.013264, 0.023533, 0.026874, 0.030505, 0.028878, 0.032773, 0.025410, 0.021074, 0.011591, 0.011063, 0.007793, 0.014379, 0.021216, 0.021076, 0.016191, 0.006646, -0.000629, 0.000885, 0.005221, 0.008676, -0.006713, -0.020526
#*# 	0.000128, 0.007147, 0.008130, 0.009460, 0.020560, 0.025436, 0.030437, 0.031993, 0.031784, 0.031126, 0.026615, 0.015339, 0.007906, 0.008410, 0.007145, 0.016243, 0.020875, 0.006807, 0.003178, -0.002838, -0.006724, 0.005093, 0.007413, -0.005716, -0.017093
#*# 	0.012119, 0.011442, 0.009445, 0.019477, 0.026105, 0.030189, 0.026941, 0.030338, 0.035563, 0.034627, 0.025858, 0.020483, 0.016441, 0.012935, 0.013033, 0.018509, 0.017985, 0.013075, 0.006741, 0.003138, -0.002905, 0.007000, 0.009917, 0.003555, -0.007575
#*# 	0.010719, 0.014456, 0.020035, 0.033201, 0.035488, 0.037179, 0.043666, 0.049854, 0.047239, 0.042068, 0.037750, 0.031567, 0.032105, 0.028423, 0.025461, 0.030603, 0.028096, 0.028114, 0.023652, 0.017972, 0.015679, 0.013919, 0.018862, 0.015864, -0.001038
#*# 	-0.003659, -0.001863, 0.008679, 0.015299, 0.021156, 0.026904, 0.027534, 0.037292, 0.031684, 0.037801, 0.028135, 0.017813, 0.011363, 0.008629, 0.014084, 0.016895, 0.015357, 0.015626, 0.005996, -0.003004, -0.005953, -0.005579, 0.002806, -0.000654, -0.010523
#*# 	-0.009239, -0.009424, -0.001513, 0.005411, 0.014048, 0.018245, 0.019369, 0.022772, 0.018188, 0.025663, 0.015642, 0.005941, 0.003130, -0.001773, -0.002320, 0.000617, 0.007578, -0.002105, -0.005635, -0.007071, -0.010695, -0.010921, -0.012800, -0.005900, -0.021874
#*# 	-0.000892, 0.001188, 0.006552, 0.016606, 0.023966, 0.021356, 0.030689, 0.026088, 0.032125, 0.033449, 0.031585, 0.012800, 0.010585, 0.002483, -0.001373, -0.001711, 0.011725, 0.005532, -0.006702, -0.010392, -0.000067, 0.004096, 0.003848, 0.003072, -0.003607
#*# 	-0.001358, -0.003091, 0.000395, 0.005205, 0.014161, 0.022115, 0.021811, 0.016082, 0.022451, 0.025260, 0.017632, 0.005492, -0.002443, -0.010018, -0.004302, -0.008974, 0.006273, -0.006625, -0.010434, -0.019501, -0.017518, -0.007159, -0.001158, -0.008788, -0.010734
#*# 	-0.003013, -0.003887, -0.009235, 0.003105, 0.006534, 0.017681, 0.012409, 0.011820, 0.015511, 0.015089, 0.014919, 0.000068, -0.007151, -0.008356, -0.012671, -0.008382, -0.003303, -0.021546, -0.017836, -0.028995, -0.037435, -0.017859, -0.013058, -0.014493, -0.024201
#*# 	0.006703, 0.003925, 0.003060, 0.005817, 0.013699, 0.019742, 0.021558, 0.022445, 0.013845, 0.024789, 0.012856, 0.005081, -0.004198, -0.003095, 0.006209, -0.001532, -0.000973, -0.013616, -0.021052, -0.027453, -0.019616, -0.017552, -0.010249, -0.008213, -0.018554
#*# 	0.005535, 0.001755, -0.001377, -0.001852, 0.005138, 0.011430, 0.014708, 0.014434, 0.015841, 0.018704, 0.011473, -0.001828, -0.007756, -0.008955, -0.005898, -0.005765, -0.012617, -0.021782, -0.026422, -0.032245, -0.029602, -0.033927, -0.019462, -0.015802, -0.020140
#*# 	-0.006307, -0.004075, -0.002684, -0.001698, -0.002337, 0.004512, 0.006955, 0.008255, 0.005656, 0.003374, 0.003427, -0.005614, -0.011857, -0.011546, -0.009936, -0.009084, -0.011864, -0.018740, -0.019102, -0.035528, -0.040035, -0.043049, -0.027219, -0.023204, -0.028777
#*# 	-0.004678, -0.006293, -0.005590, -0.001835, 0.003304, 0.004262, 0.006570, 0.006941, 0.006507, 0.000064, -0.001695, -0.012425, -0.022599, -0.023305, -0.018698, -0.017817, -0.020346, -0.023992, -0.021771, -0.022637, -0.044036, -0.043357, -0.035670, -0.026940, -0.044239
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 275.0
#*# min_y = 35.0
#*# max_y = 260.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4777751791060854,
#*# 	  1.791743650258654,
#*# 	  0.753103134001745,
#*# 	  0.376672133301129,
#*# 	  0.2873804476528069,
#*# 	  0.1942836001887098,
#*# 	  -0.07751244935002463,
#*# 	  -0.06007115429964557,
#*# 	  0.16004943209168543,
#*# 	  0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [beacon model hot]
#*# model_coef = 1.4777751791060854,
#*# 	  1.791743650258654,
#*# 	  0.753103134001745,
#*# 	  0.376672133301129,
#*# 	  0.2873804476528069,
#*# 	  0.1942836001887098,
#*# 	  -0.07751244935002463,
#*# 	  -0.06007115429964557,
#*# 	  0.16004943209168543,
#*# 	  0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
#*#
#*# [beacon model fulaflex-3_hot]
#*# model_coef = 1.4777751791060854,
#*# 	  1.791743650258654,
#*# 	  0.753103134001745,
#*# 	  0.376672133301129,
#*# 	  0.2873804476528069,
#*# 	  0.1942836001887098,
#*# 	  -0.07751244935002463,
#*# 	  -0.06007115429964557,
#*# 	  0.16004943209168543,
#*# 	  0.0993164254999361
#*# model_domain = 3.179916198362229e-07,3.3259268084197163e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 58.469861
#*# model_offset = 0.00000
